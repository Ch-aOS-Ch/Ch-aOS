{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Welcome to the Ch-aOS Project Suite","text":"<p>Ch-aOS is a suite of tools designed to declaratively manage your Unix system, from initial installation to post-install configuration. It provides a modular, safe, and didactic way to handle your entire setup.</p>"},{"location":"#core-principles","title":"Core Principles","text":"<ul> <li>Declarative: Define the desired state of your system using simple YAML files. The <code>chaos</code> CLI takes care of the rest, ensuring your system matches your declaration.</li> <li>Modular: Extend the functionality of Ch-aOS by creating or adding plugins. Whether you need to manage a different distribution, handle dotfiles, or integrate with a new secret provider, the plugin system makes it possible.</li> <li>Safe: Preview changes before they are applied with dry runs. Manage your secrets securely with integrated support for <code>sops</code> and various secret providers.</li> <li>Didactic: Learn as you go with a built-in documentation system. The <code>chaos explain</code> command provides detailed information on every feature, command, and concept.</li> </ul>"},{"location":"#how-it-works","title":"How It Works","text":"<p>The <code>chaos</code> CLI is the engine of the project, powered by Python, Pyinfra, and OmegaConf. It uses \"Ch-obolos\" (YAML files) to read data and executes \"roles\" (Python scripts) to apply the desired state to your system. This strict separation of data from logic makes your configurations readable, reusable, and version-controllable.</p>"},{"location":"#little-example","title":"Little example:","text":"<p>So, you have some secrets you want to use in your operational system, you want to place them in some files or something, but you don't want to keep decrypting, copying and printing them.</p> <p>So, I've made a little role that is a jinja2 secrets templater, you can see it in action as well!</p> <p></p> <p>Why is this SO VERBOSE?</p> <p>Well, that's Ch-aOS's optional and local logbook!</p> <p>Ready to get started? Head over to the Getting Started guide.</p> <p>Want to learn more about advanced features? Check some of the Advanced Topics!</p> <p>Want to create your own plugins? Dive into the Plugin Development documentation!</p> <p>Or you just want to follow the code's planned features? Check out our Chopping Board!</p>"},{"location":"chopping-board/","title":"Chopping Board","text":"<p>Some of the future work I plan to do on the Ch-aOS Project Suite. Feel free to contribute or suggest new features!</p>"},{"location":"chopping-board/#the-obvious-ones-ch-iron-and-ch-ronos","title":"(The obvious ones) Ch-iron and Ch-ronos","text":"<p>Fedora and Debian based official cores Ch-aronte is just the beginning! Official cores for other popular distributions like Fedora (Ch-iron) and Debian/Ubuntu (Ch-ronos) to expand Ch-aOS' reach and usability.</p>"},{"location":"chopping-board/#installation-from-0-to-fine-tuning","title":"Installation From 0 to fine-tuning","text":"<p>A complete installation flow that takes the user from a bare-metal system to a fully configured environment, including partitioning, bootloader setup, and post-install configurations, using the same declarative approach and plugin based architecture. (chaos.installer)</p>"},{"location":"chopping-board/#better-fleet-manaegment","title":"Better Fleet Manaegment","text":"<p>this has been implemented!</p> <p>Check out the docs for more information. Can be improved through an <code>--limit</code> flag on the CLI, for better targeting, but the main idea (expandable inventories) is already here.</p> <p>You know Ansible's dinamic inventories? Something similar, but following Ch-aOS' design principles. A way to manage multiple systems declaratively through an plugin-based declarative inventory system, think \"chaos-ec2-boat\" that dinamically fetches instances from AWS EC2 and applies Ch-aOS configurations to them. (chaos.boats)</p>"},{"location":"chopping-board/#the-big-one-ch-imera-ch-obolo-to-nix-mini-compilers","title":"(the big one) Ch-imera: Ch-obolo to nix mini-compilers","text":"<p>NixOS is, obviously, the best declarative OS out there. Its got atomicity, rollbacks, a MASSIVE repo, and a great community. But its language is complex, and its learning curve steep. What if we could compile Ch-aOS' Ch-obolos to Nix expressions? This would allow users to leverage NixOS' strengths while enjoying Ch-aOS' simplicity and modularity! Of course, tho, this isn't all roses, Ch-obolo generated Nix expressions would (and should) be limited, since... Well, since Ch-obolos are written in a non-Turing complete language. But still, this could be a great way to bridge the gap between the two systems, bringing a more common approach to IaC (YAML) to NixOS systems! (chaos.compilers.chimera since, if this works, we could just add a compiler for guix, for instance!)</p>"},{"location":"chopping-board/#new-one-ch-aos-archipelago","title":"(New one!) Ch-aOS archipelago.","text":"<p>Now, now, with all of these nautical references, I couldn't just not add this one! Think about it, you have a very good way to configure your system, but what about provisioning it? Ch-aOS Archipelago (or just pelago) would be a tool that utilizes the same plugin-based architecture to provision new systems on the cloud, using Pulumi as the underlying provisioning engine. Instead of just provisioning it, tho, it would be able to apply Ch-aOS configurations to it as well, making it a one-command solution for going from 0 to a fully configured VM! (chaos.isles)</p>"},{"location":"chopping-board/#atomicity-and-rollbacks","title":"Atomicity and Rollbacks","text":"<p>Atomicity is Important. Period. Implementing atomic operations is more of a roles problem than a core one, however, Ch-aOS' core could provide a built-in mechanism to support atomic and granular rollbacks, for instance, saving the state of the Ch-obolos inside ovf /var/lib after applying all changes, this would allow users to revert to a previous state in case of breakage. Atomicity can be achieved by using try/except blocks in python roles, this approach would require roles to be written with atomicity in mind, like normal configuration managers do. +1 I can already hear you say \"but what about using filesystem snapshots?\" Well, yes, that could be an option, but it would require users to use specific filesystems (like btrfs or zfs) and would add complexity to the core. This approach would be more universal and easier to implement across different systems. +1 I can and will implement a dedicated role abstract class to help role developers, with an apply() and undo() methods, but the rollbacks mechanism would be built into the core. BTW: hey, not even Ansible has atomicity and rollbacks out of the box, this is something complex to do, and the lack of it does not really stop Ansible from being very popular, so this would not be a deal breaker for Ch-aOS either!</p>"},{"location":"chopping-board/#another-big-task-ch-aos-capitain-or-should-i-say-ch-apetanios","title":"(Another big task) Ch-aOS Capitain... or should I say, Ch-apetanios","text":"<p>So, you know Ansible Tower and you know Puppet Master, get ready for... Ch-aOS Ch-apetanios! A centralized server that should provide a single point of management for multiple Ch-aOS managed systems. There are a... \"few\" steps to achieve this, such as:</p> <ul> <li> <p>Job scheduling and queuing system.</p> </li> <li> <p>Git-centric workflow (kinda like argocd, but for configuration management).</p> </li> <li> <p>Helm charts for easy deployment on k8s + Docker images for easy deployment anywhere else.</p> </li> <li> <p>Integration with the prometheus stack for metrics collection and display.</p> </li> <li> <p>TUI interface for easy management and monitoring.</p> <ul> <li> <p>visualization of the state of managed systems.</p> </li> <li> <p>logs and reports.</p> </li> <li> <p>job history.</p> </li> </ul> </li> </ul> <p>So, as you can see, this is not a small task... like, at all, but it could turn Ch-aOS into a more enterprise-ready solution for managing large fleets of systems. Also, yeah, its going to be written in Go, since... well, its a server, and Go is great for that, plus, I want to learn Go, plus plus, its a TUI, not a web app, so... yeah.</p> <p>Metrics are on the table!</p> <p>I've implemented a complete metrics collection for Ch-aOS that can be seen here, this is a first step towards Ch-apetanios, since it provides a way to collect data from multiple systems. (Also, I had to create a pyinfra FACT for this to get system hardware info, kinda cooool huuuuh?)</p>"},{"location":"chopping-board/#something-id-enjoy-using-ch-aos-styx","title":"(Something I'd enjoy using) Ch-aOS Styx","text":"<p>this has been implemented!</p> <p>Check out the docs for more information.</p> <p>Ansible has Galaxy, Puppet has Forge, Chef has Supermarket, SaltStack has the SaltStack Community Repository... Ch-aOS Styx would be an git repo with a bunch of plugin metadata and pointers, this saves me from buying a server to keep all of this info since... well, I have no money... this could integrate with chaos and make installing plugins quick n easy, plus, since it's just a bunch of metadata, I can futurally create a fully operational website to discover new plugins</p>"},{"location":"core-concepts/","title":"Core Concepts","text":"<p>Ch-aOS is built on a few core concepts that work together to provide a powerful and flexible system management experience.</p>"},{"location":"core-concepts/#ch-obolos-the-data","title":"Ch-obolos: The Data","text":"<p>A \"Ch-obolo\" is a YAML file where you declare the desired state of your system. It serves as the single source of truth, containing the data that roles will use to configure the system.</p> <p>Key Idea: Ch-obolos strictly separate data (what you want) from roles (logic) (how to achieve it).</p> <p>This makes your configurations:</p> <ul> <li> <p>Readable: All your variables are in one place, not scattered around a massive file.</p> </li> <li> <p>Reusable: Use the same roles with different Ch-obolo files for different systems.</p> </li> <li> <p>Version-Controllable: Track changes to your system's desired state using Git.</p> </li> </ul> <p>You can specify a Ch-obolo file with the <code>-c</code> flag or set a default path using <code>chaos set chobolo</code>.</p>"},{"location":"core-concepts/#example-ch-obolo","title":"Example Ch-obolo","text":"<pre><code># ch-obolo.yml\nhostname: \"my-arch-box\"\n\nusers:\n  - name: \"dex\"\n    shell: \"zsh\"\n    sudo: True\n    groups:\n      - wheel\n      - docker\n\npackages:\n  - git\n  - neovim\naurPkgs:\n  - google-chrome\n</code></pre>"},{"location":"core-concepts/#roles-the-logic","title":"Roles: The Logic","text":"<p>A \"Role\" is a Python script that contains the logic for achieving a desired state. Roles read data from your Ch-obolo (and from your secrets) file and use the <code>pyinfra</code> library to execute operations.</p> <p>When you run <code>chaos apply &lt;role_tag&gt;</code>, Ch-aOS finds the corresponding role from its installed plugins and executes it. The role first gathers \"facts\" about the system's current state, compares it to the desired state from the Ch-obolo, and then applies the necessary changes.</p> <p>This modular approach allows you to apply specific parts of your configuration independently. For example, you can run <code>chaos apply users</code> to only manage users without affecting packages or services.</p>"},{"location":"core-concepts/#plugins-the-functionality","title":"Plugins: The Functionality","text":"<p>Ch-aOS is designed to be minimal and modular. Most of its functionality is provided through external plugins. The <code>chaos</code> CLI itself is just an engine; the plugins provide the REAL power.</p> <p>There are several types of plugins:</p> <ul> <li> <p>Cores: A \"core\" is a plugin that provides the basic set of roles for managing a specific Linux distribution. For example, <code>Ch-aronte</code> is the core for Arch Linux, providing roles like <code>users</code>, <code>pkgs</code>, <code>services</code>, etc.</p> </li> <li> <p>Functionality Plugins: These plugins add specialized tools. For example, <code>chaos-dots</code> is a plugin for managing dotfiles.</p> </li> <li> <p>Secret Providers: These plugins integrate with external password managers like Bitwarden or 1Password to securely fetch encryption keys.</p> </li> <li> <p>Explanations: These plugins add documentation and explanations for various roles, concepts, or anything really, accessible via the <code>chaos explain</code> command.</p> </li> <li> <p>Keys: These plugins add boiler plate for <code>chaos init chobolo</code>, in order to help users get started faster with pre-defined configurations for specific use cases.</p> </li> <li> <p>Aliases: These plugins add shortcuts to chaos roles (kinda basic ik).</p> </li> </ul> Hey, hey you there, I've got a secret to tell you <p>Ch-aOS will have more types of plugins in the futures, chec k the Chopping Board for planned features!</p> <p>This plugin-based architecture means you only install the functionality you need, and it allows the community to extend Ch-aOS for different distributions or use cases without modifying the central CLI, also, since it's made using a pyproject structure, one plugin can easily implement 2 or more types of plugins!</p>"},{"location":"getting-started/","title":"Getting Started","text":"<p>This guide will walk you through the initial setup of the <code>chaos</code> CLI and its core components.</p>"},{"location":"getting-started/#installation","title":"Installation","text":"<p>Warning</p> <p>Currently, Ch-aOS is not available on package managers like <code>pip</code> or AUR (I'm working on it ok?) using the following command:</p> <pre><code>curl -LsSf https://raw.githubusercontent.com/Ch-aOS-Ch/Ch-aOS/refs/heads/main/install.sh | sudo bash\n</code></pre>"},{"location":"getting-started/#verify-installation","title":"Verify Installation","text":"<p>After installation, you can verify that the CLI is working and see the available commands.</p> <ol> <li> <p>Update the plugin cache:     Run the following command to make sure <code>chaos</code> discovers all installed plugins.     <pre><code>chaos -u\n</code></pre></p> </li> <li> <p>View the help menu: <pre><code>chaos -h\n</code></pre></p> </li> <li> <p>Check available components:     You can list all the roles, explanations, and aliases provided by your installed plugins.     <pre><code>chaos check roles\nchaos check explanations\n</code></pre></p> </li> </ol> <p>You are now ready to start using Ch-aOS!</p>"},{"location":"Advanced/boats/","title":"Boat Creation and Management","text":"<p>Well, you have a fleet of hosts, cool! Now, how do you codify your hosts? Like, I am 100% sure you don't want to write down every single IP address of every single server you have, right? That would be... tedious.</p> <p>Boats are a \"dynamic fleet\" configuration system for Ch-aOS. As always, boats are both optional and pluginable, allowing you and your team to create custom dynamic fleet solutions that fit your infrastructure needs, or even use community-created boats!</p>"},{"location":"Advanced/boats/#what-is-a-boat","title":"What is a Boat?","text":"<p>Boats, in their simplest form, are Python objects that merge the hosts inside of your fleet with dynamic data sources. This allows you to create fleets that adjust themselves to your needs at runtime. This is the base object for all boats:</p> <pre><code>from abc import ABC, abstractmethod\nfrom omegaconf import DictConfig, OmegaConf\nclass Boat(ABC):\n    \"\"\"\n    Abstract base class representing a generic boat.\n\n    A boat represents a dynamic provider for the fleet management system.\n    This means that each boat has to implement methods to manage its lifecycle\n    which include:\n    connecting to an external inventory provider (e.g., ec2)\n    getting the current state of the fleet\n    creating new instances\n    returning instances to the pool to list of fleets.\n\n    A boat is configured in a Ch-obolo file like so:\n    fleet:\n      parallelism: x&lt;=5\n      boats:\n        - provider: {name of this boat}\n          config:\n            {config parameters specific to this boat}\n\n      hosts:\n        - host1:\n            ssh_user: user1\n            ssh_key: /path/to/key1.pem\n\n    The 'provider' name is used to find the corresponding Boat class, and the\n    'config' block is passed to its constructor.\n    \"\"\"\n    name: str = \"override_me\"  # Subclasses MUST override this class attribute\n    config: DictConfig\n\n    def __init__(self, config: DictConfig):\n        \"\"\"\n        Initializes the Boat with its specific configuration block from the Ch-obolo file.\n        param config: A DictConfig object containing the configuration for this boat.\n        \"\"\"\n        self.config = config\n        if self.name == \"override_me\":\n            raise NotImplementedError\n\n    @abstractmethod\n    def check_connection(self) -&gt; bool:\n        \"\"\"Check if the connection to the external provider is active.\"\"\"\n        raise NotImplementedError\n\n    @abstractmethod\n    def get_fleet_config(self) -&gt; dict:\n        \"\"\"\n        Handles the retrieval of the fleet configuration from the external provider.\n        This method should return a dictionary representing the fleet configuration.\n        \"\"\"\n        raise NotImplementedError\n\n    @abstractmethod\n    def handle_boat_logic(self, fleet_config: dict) -&gt; dict | list:\n        \"\"\"\n        Handle any boat-specific logic for managing the fleet.\n        This method should take the current fleet configuration as input,\n        perform any necessary operations, and return the hosts to be added.\n        \"\"\"\n        raise NotImplementedError\n\n    def get_fleet(self, old_state: DictConfig) -&gt; DictConfig:\n        \"\"\"\n        Orchestrates the process of fetching and merging dynamic fleet configuration.\n\n        param old_state:\n              The existing OmegaConf configuration state.\n        return:\n              A new state with the dynamic hosts merged in.\n        raises ConnectionError:\n              If the boat fails to connect to its provider.\n        \"\"\"\n        if not self.check_connection():\n            raise ConnectionError(\n                f\"Boat provider '{self.__class__.name}' failed to establish a connection.\"\n            )\n\n        this_fleet_config = self.get_fleet_config()\n        hosts_to_add = self.handle_boat_logic(this_fleet_config)\n\n        if isinstance(hosts_to_add, dict):\n            hosts_to_add = [hosts_to_add]\n\n        if not isinstance(hosts_to_add, list):\n            raise ValueError(f\"Boat provider '{self.__class__.name}' returned invalid hosts format.\")\n\n        current_hosts = old_state.get(\"fleet\", {}).get(\"hosts\", [])\n        merged_hosts = current_hosts + hosts_to_add\n\n        new_state = DictConfig(OmegaConf.create(OmegaConf.to_container(old_state, resolve=True)))\n        new_state.fleet.hosts = merged_hosts\n\n        return new_state\n</code></pre> <p>As you can see, boats are abstract base classes that require plugins to implement specific methods for connecting to external providers and retrieve the fleet data and get the specific hosts to be added to the fleet.</p>"},{"location":"Advanced/boats/#using-boats-in-your-fleet","title":"Using Boats in Your Fleet","text":"<p>As seen in fleet, you have a \"hosts\" dict inside your fleet configuration. Boats only add to this list of hosts dynamically at runtime.</p> <p>It is configured as such inside your Ch-obolo file: <pre><code># ch-obolo.yml\n\nfleet:\n  # Optional: Set the max number of hosts to configure at once.\n  # Defaults to 0 (unlimited parallelism).\n  parallelism: 5\n\n  # Optional: Define boats to dynamically manage your fleet\n  # Each boat must specify a provider and its configuration\n  boats:\n    - provider: my-boat-provider\n      config:\n        param1: value1\n        param2: value2\n\n  hosts:\n    # --- Host definition using a dictionary ---\n    - my-server-01:\n        ssh_user: root\n        ssh_port: 22\n        ssh_key: /path/to/private/key\n\n    # --- You can define multiple hosts ---\n    - my-server-02:\n        ssh_user: admin\n        ssh_port: 2222\n        ssh_key: /path/to/another/key\n\n    # --- Minimal definition, relying on defaults or ssh config ---\n    - my-server-03: {}\n</code></pre></p> <p>We provide a mock boat to exemplify how boats work, you can find it here, note that it isn't registered inside of the default Ch-aOS installation, since it is only for demonstration purposes.</p>"},{"location":"Advanced/boats/#why","title":"Why?","text":"<p>First of all: most of you probably don't even need them! They are an advanced feature for very specific use cases (e.g., auto-scaling groups, ephemeral fleets, cloud fleets, etc).</p> <p>Secondly: boats provide a clean implementation for dynamic fleet management that lives alongside the static fleet configuration, which by design lives alongside the data you want to manage with Ch-aOS. This means that you can keep your fleet definition and your configuration data together, without needing to juggle multiple files or systems, which also helps a lot with discovering how exactly your infrastructure is being managed and which machines are being targeted.</p> <p>Finally: boats are pluginable! You can create your own boat classes to integrate with any external system you want, or even share them with the community, so you can have a boat for AWS, GCP or even that one weird internal system your company uses!</p>"},{"location":"Advanced/boats/#how-to-use-them","title":"How to use them:","text":"<p>Just use the <code>--fleet</code> flag when applying roles, as usual! Ch-aOS will automatically detect and use any boats defined in your fleet configuration to dynamically adjust the hosts being targeted. <pre><code>chaos apply [role_tags] --fleet\n</code></pre></p>"},{"location":"Advanced/boats/#creating-your-own-boat","title":"Creating Your Own Boat","text":"<p>So, you see those @abstractmethod decorators in the Boat class? Those are the methods you need to implement to create your own boat!</p> <p>So you need to create a new Python class that inherits from the Boat base class and implement the required methods, that means that all of the logic for connecting and retrieving the data is up to you (since I can't really read minds you know?)</p> <p>After allat, you just need to register your boat class in the Ch-aOS plugin system, so it can be discovered and used when specified in the fleet configuration. <pre><code>[project.entry_points.\"chaos.boats\"]\nmy-boat = \"my_module:MyBoatClass\"\n</code></pre></p>"},{"location":"Advanced/composability/","title":"Ch-aOS Composability Features","text":"<p>So, Ch-aOS is not just about managing machines, it also has lots of features for managing secrets, getting documentation and all sorts of other things. These features are cool and all, but what about when you want to not use the main Ch-aOS tool with them? What if you want to use them in your own scripts or tools?</p> <p>Well, that's where composability comes in. Ch-aOS is designed to be composable, meaning you can use its features in your own code without having to rely on the main Ch-aOS command-line tool.</p>"},{"location":"Advanced/composability/#how-it-works","title":"How It Works","text":"<p>Well, when you first use Ch-aOS you might see that... well, the stdouts aren't exactly what you'd want for a library. That's because Ch-aOS is primarily a CLI tool.</p> <p>However, most (if not all, hmu if you find one that isn't) of the features in Ch-aOS have a built-in \"--json\" and (if applicable) a \"--no-pretty\" flag. These flags turn the output from something quite cute into something more... machinery-y. Of course, this makes it quite easy for other programs to use Ch-aOS features.</p>"},{"location":"Advanced/composability/#why-use-composability","title":"Why Use Composability?","text":"<p>There are a few reasons why you might want to use Ch-aOS's composability features:</p> <ul> <li> <p>automation: You might want to automate certain tasks using Ch-aOS features in your own scripts or tools.</p> </li> <li> <p>integration: You might want to integrate Ch-aOS features into your own applications or systems.</p> </li> <li> <p>customization: You might want to customize the behavior of Ch-aOS features to better suit your needs.</p> </li> </ul> <p>And other use-cases I'm sure you can think of, these are just the first ones that came to mind!</p>"},{"location":"Advanced/composability/#how-to-use","title":"How to use","text":"<p>Uh... Just <code>chaos &lt;feature&gt; --json</code> or <code>chaos &lt;feature&gt; --no-pretty</code>? Like, it's really that simple. For example:</p> <pre><code>chaos explain --no-pretty -j chaos\n# Yes, I know, quite cool that you can get explanations in JSON huh?\n# just think of the possibilities! (mainly UI or documentation)\n</code></pre> <p>Returns: <pre><code>{\n  \"concept\": \"The Ch-aOS Command-Line Interface\",\n  \"what\": \"`chaos` is the main entry point for the Ch-aOS tool. It acts as a CLI to orchestrate system configuration, manage secrets, and handle team Ch-aOS configurations and documentation.\",\n  \"why\": \"It provides a single interface to some backend tools (like `pyinfra` and `sops`), simplifying complex workflows and making system management declarative and repeatable (I'M WORKING ON ATOMICITY OK?).\",\n  \"how\": \"When you run a command like `chaos apply users -s`, the CLI parses your arguments, loads the necessary configuration from your \\\"Ch-obolo\\\" file, discovers the appropriate role from its plugins, and executes the underlying logic.\",\n  \"learn_more\": [\n    \"run `chaos --help` to see all available commands.\"\n  ]\n}\n</code></pre></p> <p>Or: <pre><code>chaos explain --no-pretty chaos\n</code></pre></p> <p>Returns: <pre><code>concept: The Ch-aOS Command-Line Interface\nwhat: '`chaos` is the main entry point for the Ch-aOS tool. It acts as a CLI to orchestrate\n  system configuration, manage secrets, and handle team Ch-aOS configurations and\n  documentation.'\nwhy: It provides a single interface to some backend tools (like `pyinfra` and `sops`),\n  simplifying complex workflows and making system management declarative and repeatable\n  (I'M WORKING ON ATOMICITY OK?).\nhow: When you run a command like `chaos apply users -s`, the CLI parses your arguments,\n  loads the necessary configuration from your \"Ch-obolo\" file, discovers the appropriate\n  role from its plugins, and executes the underlying logic.\nlearn_more:\n- run `chaos --help` to see all available commands.\n</code></pre></p> <p>By the way, most of the features that have a <code>--json</code> tag need to be used with <code>--no-pretty</code> to get valid JSON output. Just a heads up!</p> <p>By using these flags, you can easily integrate Ch-aOS features into your own scripts and tools, making it a powerful and flexible tool for system management and automation.</p> <p>OH YEAH, forgot to mention! In some rare cases, you can see a teeny tiny <code>--value</code> <code>-v</code> flag. This is for when you just want the raw value of something, like a secret or a config value, without any extra formatting or metadata. Yes, this means that something like this is possible:</p> <pre><code>chaos secrets cat ssh_pass -v | chaos apply users -slye -ps\n</code></pre> Hey, hey you there, I've got a secret to tell you <p>Wanna use Ch-aOS like a big' ol <code>pass</code>? <code>chaos ramble read &lt;encrypted.note&gt; --no-pretty -v &lt;all&gt; &lt;these&gt; &lt;keys&gt;</code> will output the decrypted keys directly to stdout for easy piping, You can basically use it like a password manager CLI! (Not really the intention, but hey, it works!)</p>"},{"location":"Advanced/connectors/","title":"Pyinfra Connectors","text":"<p>Huh??? Weren't we just talking about Ch-aOS? Why Pyinfra all of the sudden??? Well, Ch-aOS uses Pyinfra under the hood to manage and configure systems, we just build a lot around it to make it a complete solution, not only a configuration management tool.</p> <p>So... what is a Pyinfra Connector? Well, glad you asked! A Pyinfra Connector is a way for Pyinfra to connect to and manage remote (or not remote) systems. Connectors define exactly how Pyinfra communicates with the target system, whether it's over SSH (the base way, without any <code>@</code>'s), via Docker, or (the base Ch-aOS way) locally.</p>"},{"location":"Advanced/connectors/#why","title":"Why?","text":"<p>So, why should you care? If you're using Ch-aOS in a more advanced way, you absolutely should care, and like, a lot! Connectors allow you to manage different systems in different ways, all while using the same framework and tooling! Since Ch-aOS simply translates your Ch-obolo inputs to Pyinfra's format, you can use any Pyinfra Connector you want with Ch-aOS, opening up a whole new world of possibilities.</p> <p>Also, it is the singular entry_point that Pyinfra even provides to extend its functionality, its like a match made in heaven for Ch-aOS!</p>"},{"location":"Advanced/connectors/#how-to-use","title":"How to Use","text":"<p>Simple! In your <code>fleet.hosts</code> key inside your Ch-obolo file, you can simply add the connector with its specific tag (e.g. <code>@dockerssh/</code> for the Docker SSH connector) to the host you want to use it with. For example: <pre><code>fleet:\n  hosts:\n    # all base Ch-aOS available connectors (I've checked the source code)\n    - '@dockerssh/my_docker_container': {}\n    - '@docker/my_docker_container': {}\n    - '@podman/my_podman_container': {}\n    - '@terraform/my_terraform_instance': {}\n    - '@chroot/mnt/my/chroot': {}\n    - '@vagrant/my_vagrant_box': {}\n    - '@local': {}\n    - 'my_remote_server': {} # This one uses the default SSH connector\n</code></pre></p> <p>Since Ch-aOS uses Pyinfra under the hood, you can use any Pyinfra Connector available on PyPI or even create your own! Since Ch-aOS' plugins are simple .whl files that install Python packages, you can easily create/install any custom connectors through <code>chaos styx invoke</code>, since it is quite literally just an entry point to Pyinfra's connector system.</p> <p>This means that, since there are multiple Pyinfra plugins are being developped inside of Pyinfra-dev, Ch-aOS could, theoretically, support even windows in the future!</p>"},{"location":"Advanced/connectors/#developing-custom-connectors","title":"Developing Custom Connectors","text":"<p>Well, Pyinfra's documentation on creating custom connectors is a bit sparse, but the general idea is that you need to create a Python package that defines a new connector class inheriting from <code>pyinfra.api.connectors.BaseConnector</code>. You then need to register this connector in your package's <code>setup.py</code> or <code>pyproject.toml</code> file under the <code>entry_points</code> section.</p> <p>A bit more can be found in Our own documentation and also in Pyinfra's documentation.</p> <p>I'll try my best to explain exactly how to create a working Connector.</p> <p>If you want to contribute directly to Ch-aOS, you can not only contribute to our repo, but also to Pyinfra's repo</p>"},{"location":"Advanced/fleet/","title":"Fleet Management","text":"<p>Ok, so you've mastered using <code>chaos</code> to configure a single machine. But what if you have multiple servers, VMs, or containers that need the same setup? What if you want to manage an entire fleet of machines with ease?</p> <p>The <code>fleet</code> feature extends <code>chaos</code> to orchestrate multiple machines simultaneously. By adding a <code>fleet</code> block to your Ch-obolo file, you can define a group of remote hosts and run roles across all of them from a single command.</p> <p>This is essential for managing any infrastructure with more than one machine, such as a cluster of web servers, a set of development VMs, or any group of computers that need consistent configuration.</p>"},{"location":"Advanced/fleet/#how-it-works","title":"How It Works","text":"<p>When you run an <code>apply</code> command with the <code>--fleet</code> flag, <code>chaos</code> will:</p> <ol> <li> <p>Read the <code>fleet</code> block from your Ch-obolo file.</p> </li> <li> <p>For each host defined, connect to it via SSH.</p> </li> <li> <p>Execute the specified roles on all hosts, either in sequence or in parallel.</p> </li> </ol>"},{"location":"Advanced/fleet/#defining-your-fleet","title":"Defining Your Fleet","text":"<p>To define your fleet, create a <code>fleet</code> key in your Ch-obolo file.</p> <pre><code># ch-obolo.yml\n\nfleet:\n  # Optional: Set the max number of hosts to configure at once.\n  # Defaults to 0 (unlimited parallelism).\n  parallelism: 5\n\n  hosts:\n    # --- Host definition using a dictionary ---\n    - my-server-01:\n        ssh_user: root\n        ssh_port: 22\n        ssh_key: /path/to/private/key\n\n    # --- You can define multiple hosts ---\n    - \"@dockerssh/my-server-02\":\n        ssh_user: admin\n        ssh_port: 2222\n        ssh_key: /path/to/another/key\n\n    # --- Minimal definition, relying on defaults or ssh config ---\n    - \"@chroot/mnt/my/root\": {}\n</code></pre> <p>Note</p> <p>Since Ch-aOS uses base <code>pyinfra</code> for remote execution, all <code>pyinfra connectors</code> are supported. This includes special connection types like <code>@dockerssh/</code>, <code>@chroot/</code>, <code>@terraform/</code>, and more. Refer to the pyinfra documentation and, better yet, pyinfra connector repo for more details on connection strings.</p> <p>The hosts are defined as a list of dictionaries, where each dictionary contains a single host and its connection data. All <code>pyinfra</code> connection arguments (like <code>ssh_user</code>, <code>ssh_port</code>, <code>ssh_key</code>, etc.) are supported.</p>"},{"location":"Advanced/fleet/#applying-roles-to-the-fleet","title":"Applying Roles to the Fleet","text":"<p>To apply roles to the fleet, use the <code>-f</code> or <code>--fleet</code> flag with the <code>chaos apply</code> command.</p> <pre><code># Apply the 'packages' role to all hosts in the fleet\nchaos apply packages --fleet\n\n# Apply multiple roles to the fleet with a dry run\nchaos apply users services --fleet --dry\n</code></pre> <p><code>chaos</code> will then connect to each host defined in your fleet and execute the roles, respecting the <code>parallelism</code> setting.</p> <p>!!! note Want to have dynamicicity in your fleet?     Take a look at our boats to learn how to use the built-in dynamic fleet management system!</p>"},{"location":"Advanced/logbook/","title":"Ch-aOS Logbook","text":"<p>Ok, you've managed your system beautifully, incredible! But what if something goes wrong? What if you need to uncover why something is not going fast enough, or why a change didn't apply as expected? You don't want to be left to check massive <code>--verbose</code> logs, and most certainly not check each host individually. So...</p> <p>Ch-aOS has a built-in state of the art data collection mechanism called the \"Logbook\". It was designed to collect the most amount of pure useful data while minimizing the performance impact on the system.</p> <p>It is a complete execution journal that captures a precise, structured and replayable record of everything that happened during a <code>chaos apply</code> run, from the high-level operations down to the EXACT commands, facts, timestamps, and system state before and after each operation.</p> <p>When I designed the Logbook, I had one singular goal in mind: collect as many useful data with as little as possible of a performance hit.</p> <p>To put it to the exact thoughts that ran through my mind when designing it: \"Pull absolutely, undoubtedly, and completely ZERO punches\" when it comes to observability. If a piece of data can be useful on any level, it BELONGS to the Logbook. No compromises.</p>"},{"location":"Advanced/logbook/#what-data-is-collected","title":"What data is collected?","text":"<p>For each execution, the Logbook captures:</p> <ul> <li> <p>Per-operation metadata and outcomes</p> </li> <li> <p>Exact commands executed, with timestamps and execution order</p> </li> <li> <p>Fact history and fact changes that influenced decisions</p> </li> <li> <p>Retry statistics and execution timings</p> </li> <li> <p>Diffs and change detection</p> </li> <li> <p>Command outputs (with sensitive data filtered when applicable)</p> </li> <li> <p>Host-level metrics (CPU, RAM, health checks)</p> </li> </ul> <p>And even the exact sequence of commands and facts gathered for each operation, both alone and together, in order. This comes from the times where I needed to debug a ansible playbook and it simply wouldn't give me enough info to figure out what was going on. With this level of detail, you can reconstruct the entire execution flow and understand exactly what happened, when, and why.</p>"},{"location":"Advanced/logbook/#no-ops-boohoo-still-logged","title":"No ops? Boohoo, still logged!","text":"<p>Even when no operations are executed (say, when everything is already in the desired state), the Logbook still captures:</p> <ul> <li> <p>pre and post operation health checks</p> </li> <li> <p>exact fact history and timestamps that led to... Well, to no ops being ran</p> </li> </ul> <p>Again, debugging background, \"No operations\" is still a state that needs to be understood sometimes. The Logbook captures it all.</p>"},{"location":"Advanced/logbook/#storage-and-format","title":"Storage and format:","text":"<p>\"Data collection\" has a bad ring to it doesn't it? Well, not in Ch-aOS. All logbooks are stored in a structured json format. Locally. At least out of the box.</p> <p>You see, when I was developing the logbook system, I quickly realized that storing everything in a single JSON file would not scale well for larger runs. So I had to come up with a better solution.</p> <p>Then I made a SQLite database backend for the Logbook, which was cool and all, but then I realized that not everyone would want to deal with databases, and that SQLite doesn't really scale well for concurrent access.</p> <p>So, the final solution was quite simple: plugins (Duh)! Ch-aOS has a plugin system for almost everything, so why not for the Logbook storage as well?</p> <p>Learn more here.!</p> <p>They can be found in these places while using the default \"chrima\" plugin:</p> <ul> <li> <p><code>./chaos-logbook.json</code></p> </li> <li> <p><code>~/.local/share/chaos/logbooks/logbook.db</code></p> </li> </ul> <p>Do note that the JSON file is always created, regardless of the storage backend used. It is there for easy access and quick debugging.</p>"},{"location":"Advanced/logbook/#enabling-and-disabling","title":"Enabling and disabling:","text":"<p>To enable, run <pre><code>chaos apply --logbook --limani &lt;limani_name&gt;\n</code></pre></p> <p>Note that you can configure a default limani in your <code>~/.config/chaos/config.yml</code> like so: <pre><code>limani: (limani_name)\n</code></pre></p> <p>To disable, simply omit the <code>--logbook</code> flag. That simple. The logging system is not even enabled on the background.</p>"},{"location":"Advanced/logbook/#privacy-and-ownership","title":"Privacy and Ownership:","text":"<p>The Logbook is local by design.</p> <p>NO data is transmitted to any external servers. NO third-party is involved.</p> <p>If the <code>--logbook</code> is omitted, the data collection system doesn't even turn on.</p> <p>Also, it is Free and Open Source. No ifs or elses or buts about it. Forever.</p>"},{"location":"Advanced/logbook/#why","title":"Why?","text":"<p>The Logbook is designed for an old me who needed to debug some serious infra issues. It was made to empower YOU to debug your own infra issues.</p> <p>If you ever needed to figure out why something didn't go as expected, the Logbook is your friend. It gives you the power to reconstruct and analyze every detail of your infrastructure changes.</p> <p>It was made to be useful for users, not only machines or senior engineers.</p>"},{"location":"Advanced/logbook/#example","title":"Example:","text":"<p>Here goes a simple Logbook of a singular role being applied to a singular host:</p> <pre><code>{\n    \"api_version\": \"v1\",\n    \"run_id\": \"chaos-2026/01/26-21:29:13\",\n    \"uggly_run_id\": \"chaos-1769462953-7451800858269\",\n    \"hailer\": {\n        \"user\": \"dexmachina\",\n        \"boatswain\": \"[Nah, you're not getting my IP]\",\n        \"hostname\": \"Dionysus\"\n    },\n    \"hosts\": {\n        \"@local\": {\n            \"total_operations\": 3,\n            \"changed_operations\": 1,\n            \"successful_operations\": 3,\n            \"failed_operations\": 0,\n            \"duration\": 0.5561,\n            \"history\": [\n                {\n                    \"operation\": \"Ensuring secrets state directory exists\",\n                    \"changed\": false,\n                    \"success\": true,\n                    \"duration\": 0.0997,\n                    \"stdout\": \"\",\n                    \"stderr\": \"\",\n                    \"diff\": \"\",\n                    \"operation_arguments\": {\n                        \"global_arguments\": {\n                            \"_sudo\": true,\n                            \"_sudo_user\": null,\n                            \"_use_sudo_login\": false,\n                            \"_sudo_password\": \"********\",\n                            \"_preserve_sudo_env\": false,\n                            \"_su_user\": null,\n                            \"_use_su_login\": false,\n                            \"_preserve_su_env\": false,\n                            \"_su_shell\": false,\n                            \"_doas\": false,\n                            \"_doas_user\": null,\n                            \"_shell_executable\": \"sh\",\n                            \"_chdir\": null,\n                            \"_env\": {},\n                            \"_success_exit_codes\": [\n                                0\n                            ],\n                            \"_timeout\": null,\n                            \"_get_pty\": false,\n                            \"_stdin\": null,\n                            \"_retries\": 0,\n                            \"_retry_delay\": 5,\n                            \"_retry_until\": null,\n                            \"_temp_dir\": null,\n                            \"name\": \"Ensuring secrets state directory exists\",\n                            \"_ignore_errors\": false,\n                            \"_continue_on_error\": false,\n                            \"_if\": []\n                        },\n                        \"operation_meta\": {\n                            \"executed\": false,\n                            \"maybe_change\": false,\n                            \"hash\": \"=784a97bf1955d5f7a2b9dd6c1e371e17b73c42bc\"\n                        },\n                        \"parent_op_hash\": null\n                    },\n                    \"retry_statistics\": {\n                        \"retry_attempts\": 0,\n                        \"max_retries\": 0,\n                        \"retry_info\": {\n                            \"retry_attempts\": 0,\n                            \"max_retries\": 0,\n                            \"was_retried\": false,\n                            \"retry_succeeded\": null\n                        }\n                    }\n                },\n                {\n                    \"operation\": \"Recording new secrets state\",\n                    \"changed\": false,\n                    \"success\": true,\n                    \"duration\": 0.297,\n                    \"stdout\": \"\",\n                    \"stderr\": \"\",\n                    \"diff\": \"\",\n                    \"operation_arguments\": {\n                        \"global_arguments\": {\n                            \"_sudo\": true,\n                            \"_sudo_user\": null,\n                            \"_use_sudo_login\": false,\n                            \"_sudo_password\": \"********\",\n                            \"_preserve_sudo_env\": false,\n                            \"_su_user\": null,\n                            \"_use_su_login\": false,\n                            \"_preserve_su_env\": false,\n                            \"_su_shell\": false,\n                            \"_doas\": false,\n                            \"_doas_user\": null,\n                            \"_shell_executable\": \"sh\",\n                            \"_chdir\": null,\n                            \"_env\": {},\n                            \"_success_exit_codes\": [\n                                0\n                            ],\n                            \"_timeout\": null,\n                            \"_get_pty\": false,\n                            \"_stdin\": null,\n                            \"_retries\": 0,\n                            \"_retry_delay\": 5,\n                            \"_retry_until\": null,\n                            \"_temp_dir\": null,\n                            \"name\": \"Recording new secrets state\",\n                            \"_ignore_errors\": false,\n                            \"_continue_on_error\": false,\n                            \"_if\": []\n                        },\n                        \"operation_meta\": {\n                            \"executed\": false,\n                            \"maybe_change\": false,\n                            \"hash\": \"=9c1c01dc3ac1445a500251fc34a15d3e75a849df\"\n                        },\n                        \"parent_op_hash\": null\n                    },\n                    \"retry_statistics\": {\n                        \"retry_attempts\": 0,\n                        \"max_retries\": 0,\n                        \"retry_info\": {\n                            \"retry_attempts\": 0,\n                            \"max_retries\": 0,\n                            \"was_retried\": false,\n                            \"retry_succeeded\": null\n                        }\n                    }\n                },\n                {\n                    \"operation\": \"Deploy secret template to /home/dexmachina/hi.txt for user dexmachina\",\n                    \"changed\": true,\n                    \"success\": true,\n                    \"duration\": 0.1594,\n                    \"stdout\": \"\",\n                    \"stderr\": \"\",\n                    \"diff\": \"Will modify /home/dexmachina/hi.txt\\n  @@ -1 +1 @@\\n  - nooooooooo\\n[SENSITIVE DATA FILTERED]\\n\\nSuccess\",\n                    \"operation_arguments\": {\n                        \"global_arguments\": {\n                            \"_sudo\": true,\n                            \"_sudo_user\": \"dexmachina\",\n                            \"_use_sudo_login\": false,\n                            \"_sudo_password\": \"********\",\n                            \"_preserve_sudo_env\": false,\n                            \"_su_user\": null,\n                            \"_use_su_login\": false,\n                            \"_preserve_su_env\": false,\n                            \"_su_shell\": false,\n                            \"_doas\": false,\n                            \"_doas_user\": null,\n                            \"_shell_executable\": \"sh\",\n                            \"_chdir\": null,\n                            \"_env\": {},\n                            \"_success_exit_codes\": [\n                                0\n                            ],\n                            \"_timeout\": null,\n                            \"_get_pty\": false,\n                            \"_stdin\": null,\n                            \"_retries\": 0,\n                            \"_retry_delay\": 5,\n                            \"_retry_until\": null,\n                            \"_temp_dir\": null,\n                            \"name\": \"Deploy secret template to /home/dexmachina/hi.txt for user dexmachina\",\n                            \"_ignore_errors\": false,\n                            \"_continue_on_error\": false,\n                            \"_if\": []\n                        },\n                        \"operation_meta\": {\n                            \"executed\": false,\n                            \"maybe_change\": true,\n                            \"hash\": \"=f4f59e822581d785ba910fbf3f268eca79db8204\"\n                        },\n                        \"parent_op_hash\": null\n                    },\n                    \"retry_statistics\": {\n                        \"retry_attempts\": 0,\n                        \"max_retries\": 0,\n                        \"retry_info\": {\n                            \"retry_attempts\": 0,\n                            \"max_retries\": 0,\n                            \"was_retried\": false,\n                            \"retry_succeeded\": null\n                        }\n                    }\n                }\n            ]\n        },\n        \"Dionysus\": {\n            \"total_operations\": 1,\n            \"changed_operations\": 0,\n            \"successful_operations\": 1,\n            \"failed_operations\": 0,\n            \"duration\": 0.035,\n            \"history\": [\n                {\n                    \"operation\": \"chaos_setup\",\n                    \"changed\": false,\n                    \"success\": true,\n                    \"duration\": 0.035,\n                    \"stdout\": \"\",\n                    \"stderr\": \"\",\n                    \"diff\": \"\",\n                    \"operation_arguments\": {\n                        \"message\": \"Time spent connecting to hosts and preparing the run.\"\n                    },\n                    \"retry_statistics\": {}\n                }\n            ]\n        }\n    },\n    \"summary\": {\n        \"total_operations\": 4,\n        \"changed_operations\": 1,\n        \"successful_operations\": 4,\n        \"failed_operations\": 0,\n        \"total_duration\": 0.5911,\n        \"status\": \"in_progress\"\n    },\n    \"resource_history\": [\n        {\n            \"type\": \"health_check\",\n            \"host\": \"@local\",\n            \"stage\": \"pre_operations\",\n            \"timestamp\": 1769462953.6523194,\n            \"metrics\": {\n                \"cpu_load_1min\": 0.67,\n                \"cpu_load_5min\": 0.71,\n                \"ram_percent\": 24.0,\n                \"ram_used_gb\": 3.69,\n                \"ram_total_gb\": 15.37\n            }\n        },\n        {\n            \"type\": \"health_check\",\n            \"host\": \"@local\",\n            \"stage\": \"post_operations\",\n            \"timestamp\": 1769462955.127124,\n            \"metrics\": {\n                \"cpu_load_1min\": 0.67,\n                \"cpu_load_5min\": 0.71,\n                \"ram_percent\": 24.4,\n                \"ram_used_gb\": 3.76,\n                \"ram_total_gb\": 15.37\n            }\n        }\n    ],\n    \"fact_history\": [\n        {\n            \"id\": 114,\n            \"run_id\": \"chaos-1769462953-7451800858269\",\n            \"timestamp\": 1769462953.625242,\n            \"log_level\": \"DEBUG\",\n            \"context\": \"fact_gathering\",\n            \"command\": \"chaos.lib.facts.facts.RamUsage () (ensure_hosts: None)\"\n        },\n        {\n            \"id\": 116,\n            \"run_id\": \"chaos-1769462953-7451800858269\",\n            \"timestamp\": 1769462953.6394317,\n            \"log_level\": \"DEBUG\",\n            \"context\": \"fact_gathering\",\n            \"command\": \"chaos.lib.facts.facts.LoadAverage () (ensure_hosts: None)\"\n        },\n        {\n            \"id\": 118,\n            \"run_id\": \"chaos-1769462953-7451800858269\",\n            \"timestamp\": 1769462953.8033183,\n            \"log_level\": \"DEBUG\",\n            \"context\": \"fact_gathering\",\n            \"command\": \"server.Command (command=cat /var/lib/chaos/secrets.yml || true) (ensure_hosts: None)\"\n        },\n        {\n            \"id\": 121,\n            \"run_id\": \"chaos-1769462953-7451800858269\",\n            \"timestamp\": 1769462953.9566145,\n            \"log_level\": \"DEBUG\",\n            \"context\": \"fact_gathering\",\n            \"command\": \"files.Directory (path=/var/lib/chaos) (ensure_hosts: None)\"\n        },\n        {\n            \"id\": 123,\n            \"run_id\": \"chaos-1769462953-7451800858269\",\n            \"timestamp\": 1769462954.0611074,\n            \"log_level\": \"DEBUG\",\n            \"context\": \"fact_gathering\",\n            \"command\": \"files.File (path=/var/lib/chaos/secrets.yml) (ensure_hosts: None)\"\n        },\n        {\n            \"id\": 125,\n            \"run_id\": \"chaos-1769462953-7451800858269\",\n            \"timestamp\": 1769462954.1574748,\n            \"log_level\": \"DEBUG\",\n            \"context\": \"fact_gathering\",\n            \"command\": \"files.Directory (path=/var/lib/chaos) (ensure_hosts: None)\"\n        },\n        {\n            \"id\": 127,\n            \"run_id\": \"chaos-1769462953-7451800858269\",\n            \"timestamp\": 1769462954.2557058,\n            \"log_level\": \"DEBUG\",\n            \"context\": \"fact_gathering\",\n            \"command\": \"files.Sha1File (path=/var/lib/chaos/secrets.yml) (ensure_hosts: None)\"\n        },\n        {\n            \"id\": 129,\n            \"run_id\": \"chaos-1769462953-7451800858269\",\n            \"timestamp\": 1769462954.3900864,\n            \"log_level\": \"DEBUG\",\n            \"context\": \"fact_gathering\",\n            \"command\": \"server.Home (user=dexmachina) (ensure_hosts: None)\"\n        },\n        {\n            \"id\": 131,\n            \"run_id\": \"chaos-1769462953-7451800858269\",\n            \"timestamp\": 1769462954.4046955,\n            \"log_level\": \"DEBUG\",\n            \"context\": \"fact_gathering\",\n            \"command\": \"files.File (path=/home/dexmachina/hi.txt) (ensure_hosts: None)\"\n        },\n        {\n            \"id\": 133,\n            \"run_id\": \"chaos-1769462953-7451800858269\",\n            \"timestamp\": 1769462954.4293916,\n            \"log_level\": \"DEBUG\",\n            \"context\": \"fact_gathering\",\n            \"command\": \"files.Directory (path=/home/dexmachina) (ensure_hosts: None)\"\n        },\n        {\n            \"id\": 135,\n            \"run_id\": \"chaos-1769462953-7451800858269\",\n            \"timestamp\": 1769462954.4545438,\n            \"log_level\": \"DEBUG\",\n            \"context\": \"fact_gathering\",\n            \"command\": \"files.Sha1File (path=/home/dexmachina/hi.txt) (ensure_hosts: None)\"\n        },\n        {\n            \"id\": 137,\n            \"run_id\": \"chaos-1769462953-7451800858269\",\n            \"timestamp\": 1769462954.4793203,\n            \"log_level\": \"DEBUG\",\n            \"context\": \"fact_gathering\",\n            \"command\": \"files.FileContents (path=/home/dexmachina/hi.txt) (ensure_hosts: None)\"\n        },\n        {\n            \"id\": 139,\n            \"run_id\": \"chaos-1769462953-7451800858269\",\n            \"timestamp\": 1769462954.5030155,\n            \"log_level\": \"DEBUG\",\n            \"context\": \"fact_gathering\",\n            \"command\": \"server.TmpDir () (ensure_hosts: None)\"\n        },\n        {\n            \"id\": 141,\n            \"run_id\": \"chaos-1769462953-7451800858269\",\n            \"timestamp\": 1769462954.5272543,\n            \"log_level\": \"DEBUG\",\n            \"context\": \"fact_gathering\",\n            \"command\": \"files.Directory (path=/var/lib/chaos) (ensure_hosts: None)\"\n        },\n        {\n            \"id\": 143,\n            \"run_id\": \"chaos-1769462953-7451800858269\",\n            \"timestamp\": 1769462954.6325512,\n            \"log_level\": \"DEBUG\",\n            \"context\": \"fact_gathering\",\n            \"command\": \"files.File (path=/var/lib/chaos/secrets.yml) (ensure_hosts: None)\"\n        },\n        {\n            \"id\": 145,\n            \"run_id\": \"chaos-1769462953-7451800858269\",\n            \"timestamp\": 1769462954.7294667,\n            \"log_level\": \"DEBUG\",\n            \"context\": \"fact_gathering\",\n            \"command\": \"files.Directory (path=/var/lib/chaos) (ensure_hosts: None)\"\n        },\n        {\n            \"id\": 147,\n            \"run_id\": \"chaos-1769462953-7451800858269\",\n            \"timestamp\": 1769462954.8299549,\n            \"log_level\": \"DEBUG\",\n            \"context\": \"fact_gathering\",\n            \"command\": \"files.Sha1File (path=/var/lib/chaos/secrets.yml) (ensure_hosts: None)\"\n        },\n        {\n            \"id\": 149,\n            \"run_id\": \"chaos-1769462953-7451800858269\",\n            \"timestamp\": 1769462954.935149,\n            \"log_level\": \"DEBUG\",\n            \"context\": \"fact_gathering\",\n            \"command\": \"files.File (path=/home/dexmachina/hi.txt) (ensure_hosts: None)\"\n        },\n        {\n            \"id\": 151,\n            \"run_id\": \"chaos-1769462953-7451800858269\",\n            \"timestamp\": 1769462954.9605896,\n            \"log_level\": \"DEBUG\",\n            \"context\": \"fact_gathering\",\n            \"command\": \"files.Directory (path=/home/dexmachina) (ensure_hosts: None)\"\n        },\n        {\n            \"id\": 153,\n            \"run_id\": \"chaos-1769462953-7451800858269\",\n            \"timestamp\": 1769462954.985443,\n            \"log_level\": \"DEBUG\",\n            \"context\": \"fact_gathering\",\n            \"command\": \"files.Sha1File (path=/home/dexmachina/hi.txt) (ensure_hosts: None)\"\n        },\n        {\n            \"id\": 155,\n            \"run_id\": \"chaos-1769462953-7451800858269\",\n            \"timestamp\": 1769462955.009414,\n            \"log_level\": \"DEBUG\",\n            \"context\": \"fact_gathering\",\n            \"command\": \"files.FileContents (path=/home/dexmachina/hi.txt) (ensure_hosts: None)\"\n        },\n        {\n            \"id\": 160,\n            \"run_id\": \"chaos-1769462953-7451800858269\",\n            \"timestamp\": 1769462955.1002316,\n            \"log_level\": \"DEBUG\",\n            \"context\": \"fact_gathering\",\n            \"command\": \"chaos.lib.facts.facts.RamUsage () (ensure_hosts: None)\"\n        },\n        {\n            \"id\": 162,\n            \"run_id\": \"chaos-1769462953-7451800858269\",\n            \"timestamp\": 1769462955.113255,\n            \"log_level\": \"DEBUG\",\n            \"context\": \"fact_gathering\",\n            \"command\": \"chaos.lib.facts.facts.LoadAverage () (ensure_hosts: None)\"\n        }\n    ],\n    \"streamed_history\": [\n        {\n            \"type\": \"progress\",\n            \"host\": \"@local\",\n            \"operation\": \"Ensuring secrets state directory exists\",\n            \"changed\": false,\n            \"success\": true,\n            \"duration\": 0.0997,\n            \"logs\": {\n                \"stdout\": \"\",\n                \"stderr\": \"\"\n            },\n            \"diff\": \"\",\n            \"operation_arguments\": {\n                \"global_arguments\": {\n                    \"_sudo\": true,\n                    \"_sudo_user\": null,\n                    \"_use_sudo_login\": false,\n                    \"_sudo_password\": \"********\",\n                    \"_preserve_sudo_env\": false,\n                    \"_su_user\": null,\n                    \"_use_su_login\": false,\n                    \"_preserve_su_env\": false,\n                    \"_su_shell\": false,\n                    \"_doas\": false,\n                    \"_doas_user\": null,\n                    \"_shell_executable\": \"sh\",\n                    \"_chdir\": null,\n                    \"_env\": {},\n                    \"_success_exit_codes\": [\n                        0\n                    ],\n                    \"_timeout\": null,\n                    \"_get_pty\": false,\n                    \"_stdin\": null,\n                    \"_retries\": 0,\n                    \"_retry_delay\": 5,\n                    \"_retry_until\": null,\n                    \"_temp_dir\": null,\n                    \"name\": \"Ensuring secrets state directory exists\",\n                    \"_ignore_errors\": false,\n                    \"_continue_on_error\": false,\n                    \"_if\": []\n                },\n                \"operation_meta\": {\n                    \"executed\": false,\n                    \"maybe_change\": false,\n                    \"hash\": \"=784a97bf1955d5f7a2b9dd6c1e371e17b73c42bc\"\n                },\n                \"parent_op_hash\": null\n            },\n            \"retry_statistics\": {\n                \"retry_attempts\": 0,\n                \"max_retries\": 0,\n                \"retry_info\": {\n                    \"retry_attempts\": 0,\n                    \"max_retries\": 0,\n                    \"was_retried\": false,\n                    \"retry_succeeded\": null\n                }\n            },\n            \"command_n_fact_history\": [\n                {\n                    \"id\": 141,\n                    \"run_id\": \"chaos-1769462953-7451800858269\",\n                    \"timestamp\": 1769462954.5272543,\n                    \"log_level\": \"DEBUG\",\n                    \"context\": \"fact_gathering\",\n                    \"command\": \"files.Directory (path=/var/lib/chaos) (ensure_hosts: None)\"\n                },\n                {\n                    \"id\": 142,\n                    \"run_id\": \"chaos-1769462953-7451800858269\",\n                    \"timestamp\": 1769462954.5327191,\n                    \"log_level\": \"DEBUG\",\n                    \"context\": \"running_command_on_localhost\",\n                    \"command\": \"env SUDO_ASKPASS=/tmp/pyinfra-sudo-askpass-zX6bBpJA0xbp *** sudo -H -A -k sh -c '! (test -e /var/lib/chaos || test -L /var/lib/chaos ) || ( stat -c '\\\"'\\\"'user=%U group=%G mode=%A atime=%X mtime=%Y ctime=%Z size=%s %N'\\\"'\\\"' /var/lib/chaos 2&gt; /dev/null || stat -f '\\\"'\\\"'user=%Su group=%Sg mode=%Sp atime=%a mtime=%m ctime=%c size=%z %N%SY'\\\"'\\\"' /var/lib/chaos || ls -ld /var/lib/chaos )'\"\n                }\n            ]\n        },\n        {\n            \"type\": \"progress\",\n            \"host\": \"@local\",\n            \"operation\": \"Recording new secrets state\",\n            \"changed\": false,\n            \"success\": true,\n            \"duration\": 0.297,\n            \"logs\": {\n                \"stdout\": \"\",\n                \"stderr\": \"\"\n            },\n            \"diff\": \"\",\n            \"operation_arguments\": {\n                \"global_arguments\": {\n                    \"_sudo\": true,\n                    \"_sudo_user\": null,\n                    \"_use_sudo_login\": false,\n                    \"_sudo_password\": \"********\",\n                    \"_preserve_sudo_env\": false,\n                    \"_su_user\": null,\n                    \"_use_su_login\": false,\n                    \"_preserve_su_env\": false,\n                    \"_su_shell\": false,\n                    \"_doas\": false,\n                    \"_doas_user\": null,\n                    \"_shell_executable\": \"sh\",\n                    \"_chdir\": null,\n                    \"_env\": {},\n                    \"_success_exit_codes\": [\n                        0\n                    ],\n                    \"_timeout\": null,\n                    \"_get_pty\": false,\n                    \"_stdin\": null,\n                    \"_retries\": 0,\n                    \"_retry_delay\": 5,\n                    \"_retry_until\": null,\n                    \"_temp_dir\": null,\n                    \"name\": \"Recording new secrets state\",\n                    \"_ignore_errors\": false,\n                    \"_continue_on_error\": false,\n                    \"_if\": []\n                },\n                \"operation_meta\": {\n                    \"executed\": false,\n                    \"maybe_change\": false,\n                    \"hash\": \"=9c1c01dc3ac1445a500251fc34a15d3e75a849df\"\n                },\n                \"parent_op_hash\": null\n            },\n            \"retry_statistics\": {\n                \"retry_attempts\": 0,\n                \"max_retries\": 0,\n                \"retry_info\": {\n                    \"retry_attempts\": 0,\n                    \"max_retries\": 0,\n                    \"was_retried\": false,\n                    \"retry_succeeded\": null\n                }\n            },\n            \"command_n_fact_history\": [\n                {\n                    \"id\": 143,\n                    \"run_id\": \"chaos-1769462953-7451800858269\",\n                    \"timestamp\": 1769462954.6325512,\n                    \"log_level\": \"DEBUG\",\n                    \"context\": \"fact_gathering\",\n                    \"command\": \"files.File (path=/var/lib/chaos/secrets.yml) (ensure_hosts: None)\"\n                },\n                {\n                    \"id\": 144,\n                    \"run_id\": \"chaos-1769462953-7451800858269\",\n                    \"timestamp\": 1769462954.6381323,\n                    \"log_level\": \"DEBUG\",\n                    \"context\": \"running_command_on_localhost\",\n                    \"command\": \"env SUDO_ASKPASS=/tmp/pyinfra-sudo-askpass-zX6bBpJA0xbp *** sudo -H -A -k sh -c '! (test -e /var/lib/chaos/secrets.yml || test -L /var/lib/chaos/secrets.yml ) || ( stat -c '\\\"'\\\"'user=%U group=%G mode=%A atime=%X mtime=%Y ctime=%Z size=%s %N'\\\"'\\\"' /var/lib/chaos/secrets.yml 2&gt; /dev/null || stat -f '\\\"'\\\"'user=%Su group=%Sg mode=%Sp atime=%a mtime=%m ctime=%c size=%z %N%SY'\\\"'\\\"' /var/lib/chaos/secrets.yml || ls -ld /var/lib/chaos/secrets.yml )'\"\n                },\n                {\n                    \"id\": 145,\n                    \"run_id\": \"chaos-1769462953-7451800858269\",\n                    \"timestamp\": 1769462954.7294667,\n                    \"log_level\": \"DEBUG\",\n                    \"context\": \"fact_gathering\",\n                    \"command\": \"files.Directory (path=/var/lib/chaos) (ensure_hosts: None)\"\n                },\n                {\n                    \"id\": 146,\n                    \"run_id\": \"chaos-1769462953-7451800858269\",\n                    \"timestamp\": 1769462954.7347271,\n                    \"log_level\": \"DEBUG\",\n                    \"context\": \"running_command_on_localhost\",\n                    \"command\": \"env SUDO_ASKPASS=/tmp/pyinfra-sudo-askpass-zX6bBpJA0xbp *** sudo -H -A -k sh -c '! (test -e /var/lib/chaos || test -L /var/lib/chaos ) || ( stat -c '\\\"'\\\"'user=%U group=%G mode=%A atime=%X mtime=%Y ctime=%Z size=%s %N'\\\"'\\\"' /var/lib/chaos 2&gt; /dev/null || stat -f '\\\"'\\\"'user=%Su group=%Sg mode=%Sp atime=%a mtime=%m ctime=%c size=%z %N%SY'\\\"'\\\"' /var/lib/chaos || ls -ld /var/lib/chaos )'\"\n                },\n                {\n                    \"id\": 147,\n                    \"run_id\": \"chaos-1769462953-7451800858269\",\n                    \"timestamp\": 1769462954.8299549,\n                    \"log_level\": \"DEBUG\",\n                    \"context\": \"fact_gathering\",\n                    \"command\": \"files.Sha1File (path=/var/lib/chaos/secrets.yml) (ensure_hosts: None)\"\n                },\n                {\n                    \"id\": 148,\n                    \"run_id\": \"chaos-1769462953-7451800858269\",\n                    \"timestamp\": 1769462954.8355799,\n                    \"log_level\": \"DEBUG\",\n                    \"context\": \"running_command_on_localhost\",\n                    \"command\": \"env SUDO_ASKPASS=/tmp/pyinfra-sudo-askpass-zX6bBpJA0xbp *** sudo -H -A -k sh -c 'test -e /var/lib/chaos/secrets.yml &amp;&amp; ( sha1sum /var/lib/chaos/secrets.yml 2&gt; /dev/null || shasum /var/lib/chaos/secrets.yml 2&gt; /dev/null || sha1 /var/lib/chaos/secrets.yml 2&gt; /dev/null ) || true'\"\n                }\n            ]\n        },\n        {\n            \"type\": \"progress\",\n            \"host\": \"@local\",\n            \"operation\": \"Deploy secret template to /home/dexmachina/hi.txt for user dexmachina\",\n            \"changed\": true,\n            \"success\": true,\n            \"duration\": 0.1594,\n            \"logs\": {\n                \"stdout\": \"\",\n                \"stderr\": \"\"\n            },\n            \"diff\": \"Will modify /home/dexmachina/hi.txt\\n  @@ -1 +1 @@\\n  - nooooooooo\\n[SENSITIVE DATA FILTERED]\\n\\nSuccess\",\n            \"operation_arguments\": {\n                \"global_arguments\": {\n                    \"_sudo\": true,\n                    \"_sudo_user\": \"dexmachina\",\n                    \"_use_sudo_login\": false,\n                    \"_sudo_password\": \"********\",\n                    \"_preserve_sudo_env\": false,\n                    \"_su_user\": null,\n                    \"_use_su_login\": false,\n                    \"_preserve_su_env\": false,\n                    \"_su_shell\": false,\n                    \"_doas\": false,\n                    \"_doas_user\": null,\n                    \"_shell_executable\": \"sh\",\n                    \"_chdir\": null,\n                    \"_env\": {},\n                    \"_success_exit_codes\": [\n                        0\n                    ],\n                    \"_timeout\": null,\n                    \"_get_pty\": false,\n                    \"_stdin\": null,\n                    \"_retries\": 0,\n                    \"_retry_delay\": 5,\n                    \"_retry_until\": null,\n                    \"_temp_dir\": null,\n                    \"name\": \"Deploy secret template to /home/dexmachina/hi.txt for user dexmachina\",\n                    \"_ignore_errors\": false,\n                    \"_continue_on_error\": false,\n                    \"_if\": []\n                },\n                \"operation_meta\": {\n                    \"executed\": false,\n                    \"maybe_change\": true,\n                    \"hash\": \"=f4f59e822581d785ba910fbf3f268eca79db8204\"\n                },\n                \"parent_op_hash\": null\n            },\n            \"retry_statistics\": {\n                \"retry_attempts\": 0,\n                \"max_retries\": 0,\n                \"retry_info\": {\n                    \"retry_attempts\": 0,\n                    \"max_retries\": 0,\n                    \"was_retried\": false,\n                    \"retry_succeeded\": null\n                }\n            },\n            \"command_n_fact_history\": [\n                {\n                    \"id\": 149,\n                    \"run_id\": \"chaos-1769462953-7451800858269\",\n                    \"timestamp\": 1769462954.935149,\n                    \"log_level\": \"DEBUG\",\n                    \"context\": \"fact_gathering\",\n                    \"command\": \"files.File (path=/home/dexmachina/hi.txt) (ensure_hosts: None)\"\n                },\n                {\n                    \"id\": 150,\n                    \"run_id\": \"chaos-1769462953-7451800858269\",\n                    \"timestamp\": 1769462954.9405642,\n                    \"log_level\": \"DEBUG\",\n                    \"context\": \"running_command_on_localhost\",\n                    \"command\": \"env SUDO_ASKPASS=/tmp/pyinfra-sudo-askpass-zX6bBpJA0xbp *** sudo -H -A -k -u dexmachina sh -c '! (test -e /home/dexmachina/hi.txt || test -L /home/dexmachina/hi.txt ) || ( stat -c '\\\"'\\\"'user=%U group=%G mode=%A atime=%X mtime=%Y ctime=%Z size=%s %N'\\\"'\\\"' /home/dexmachina/hi.txt 2&gt; /dev/null || stat -f '\\\"'\\\"'user=%Su group=%Sg mode=%Sp atime=%a mtime=%m ctime=%c size=%z %N%SY'\\\"'\\\"' /home/dexmachina/hi.txt || ls -ld /home/dexmachina/hi.txt )'\"\n                },\n                {\n                    \"id\": 151,\n                    \"run_id\": \"chaos-1769462953-7451800858269\",\n                    \"timestamp\": 1769462954.9605896,\n                    \"log_level\": \"DEBUG\",\n                    \"context\": \"fact_gathering\",\n                    \"command\": \"files.Directory (path=/home/dexmachina) (ensure_hosts: None)\"\n                },\n                {\n                    \"id\": 152,\n                    \"run_id\": \"chaos-1769462953-7451800858269\",\n                    \"timestamp\": 1769462954.9658906,\n                    \"log_level\": \"DEBUG\",\n                    \"context\": \"running_command_on_localhost\",\n                    \"command\": \"env SUDO_ASKPASS=/tmp/pyinfra-sudo-askpass-zX6bBpJA0xbp *** sudo -H -A -k -u dexmachina sh -c '! (test -e /home/dexmachina || test -L /home/dexmachina ) || ( stat -c '\\\"'\\\"'user=%U group=%G mode=%A atime=%X mtime=%Y ctime=%Z size=%s %N'\\\"'\\\"' /home/dexmachina 2&gt; /dev/null || stat -f '\\\"'\\\"'user=%Su group=%Sg mode=%Sp atime=%a mtime=%m ctime=%c size=%z %N%SY'\\\"'\\\"' /home/dexmachina || ls -ld /home/dexmachina )'\"\n                },\n                {\n                    \"id\": 153,\n                    \"run_id\": \"chaos-1769462953-7451800858269\",\n                    \"timestamp\": 1769462954.985443,\n                    \"log_level\": \"DEBUG\",\n                    \"context\": \"fact_gathering\",\n                    \"command\": \"files.Sha1File (path=/home/dexmachina/hi.txt) (ensure_hosts: None)\"\n                },\n                {\n                    \"id\": 154,\n                    \"run_id\": \"chaos-1769462953-7451800858269\",\n                    \"timestamp\": 1769462954.990778,\n                    \"log_level\": \"DEBUG\",\n                    \"context\": \"running_command_on_localhost\",\n                    \"command\": \"env SUDO_ASKPASS=/tmp/pyinfra-sudo-askpass-zX6bBpJA0xbp *** sudo -H -A -k -u dexmachina sh -c 'test -e /home/dexmachina/hi.txt &amp;&amp; ( sha1sum /home/dexmachina/hi.txt 2&gt; /dev/null || shasum /home/dexmachina/hi.txt 2&gt; /dev/null || sha1 /home/dexmachina/hi.txt 2&gt; /dev/null ) || true'\"\n                },\n                {\n                    \"id\": 155,\n                    \"run_id\": \"chaos-1769462953-7451800858269\",\n                    \"timestamp\": 1769462955.009414,\n                    \"log_level\": \"DEBUG\",\n                    \"context\": \"fact_gathering\",\n                    \"command\": \"files.FileContents (path=/home/dexmachina/hi.txt) (ensure_hosts: None)\"\n                },\n                {\n                    \"id\": 156,\n                    \"run_id\": \"chaos-1769462953-7451800858269\",\n                    \"timestamp\": 1769462955.0148454,\n                    \"log_level\": \"DEBUG\",\n                    \"context\": \"running_command_on_localhost\",\n                    \"command\": \"env SUDO_ASKPASS=/tmp/pyinfra-sudo-askpass-zX6bBpJA0xbp *** sudo -H -A -k -u dexmachina sh -c 'cat /home/dexmachina/hi.txt'\"\n                },\n                {\n                    \"id\": 157,\n                    \"run_id\": \"chaos-1769462953-7451800858269\",\n                    \"timestamp\": 1769462955.0330842,\n                    \"log_level\": \"DEBUG\",\n                    \"context\": \"running_command_on_localhost\",\n                    \"command\": \"env SUDO_ASKPASS=/tmp/pyinfra-sudo-askpass-zX6bBpJA0xbp *** sudo -H -A -k -u dexmachina sh -c 'cp /tmp/tmp028e11k_ /home/dexmachina/hi.txt'\"\n                },\n                {\n                    \"id\": 158,\n                    \"run_id\": \"chaos-1769462953-7451800858269\",\n                    \"timestamp\": 1769462955.0502923,\n                    \"log_level\": \"DEBUG\",\n                    \"context\": \"running_command_on_localhost\",\n                    \"command\": \"env SUDO_ASKPASS=/tmp/pyinfra-sudo-askpass-zX6bBpJA0xbp *** sudo -H -A -k -u dexmachina sh -c 'chown dexmachina /home/dexmachina/hi.txt'\"\n                },\n                {\n                    \"id\": 159,\n                    \"run_id\": \"chaos-1769462953-7451800858269\",\n                    \"timestamp\": 1769462955.066942,\n                    \"log_level\": \"DEBUG\",\n                    \"context\": \"running_command_on_localhost\",\n                    \"command\": \"env SUDO_ASKPASS=/tmp/pyinfra-sudo-askpass-zX6bBpJA0xbp *** sudo -H -A -k -u dexmachina sh -c 'chmod 600 /home/dexmachina/hi.txt'\"\n                }\n            ]\n        },\n        {\n            \"type\": \"progress\",\n            \"host\": \"Dionysus\",\n            \"operation\": \"chaos_setup\",\n            \"changed\": false,\n            \"success\": true,\n            \"duration\": 0.035,\n            \"logs\": {},\n            \"diff\": \"\",\n            \"operation_arguments\": {\n                \"message\": \"Time spent connecting to hosts and preparing the run.\"\n            },\n            \"retry_statistics\": {},\n            \"command_n_fact_history\": []\n        }\n    ],\n    \"operation_summary\": {\n        \"Ensuring secrets state directory exists\": {\n            \"count\": 1,\n            \"total_duration\": 0.0997,\n            \"average_duration\": 0.0997,\n            \"p50_duration\": 0.0997,\n            \"p90_duration\": 0.0997,\n            \"p95_duration\": 0.0997,\n            \"p99_duration\": 0.0997\n        },\n        \"Recording new secrets state\": {\n            \"count\": 1,\n            \"total_duration\": 0.297,\n            \"average_duration\": 0.297,\n            \"p50_duration\": 0.297,\n            \"p90_duration\": 0.297,\n            \"p95_duration\": 0.297,\n            \"p99_duration\": 0.297\n        },\n        \"Deploy secret template to /home/dexmachina/hi.txt for user dexmachina\": {\n            \"count\": 1,\n            \"total_duration\": 0.1594,\n            \"average_duration\": 0.1594,\n            \"p50_duration\": 0.1594,\n            \"p90_duration\": 0.1594,\n            \"p95_duration\": 0.1594,\n            \"p99_duration\": 0.1594\n        },\n        \"chaos_setup\": {\n            \"count\": 1,\n            \"total_duration\": 0.035,\n            \"average_duration\": 0.035,\n            \"p50_duration\": 0.035,\n            \"p90_duration\": 0.035,\n            \"p95_duration\": 0.035,\n            \"p99_duration\": 0.035\n        }\n    }\n}\n</code></pre>"},{"location":"Advanced/providers/","title":"Secret Providers","text":"<p>So, you don't use passwords for file encryption, you use keys, fantastic! But then, where in the nine hells of Dante do you store those keys? They aren't physical objects you can just put in a keyring, nor are they something you want to leave lying around in your home directory. Most certainly it is not something you want to lose!</p> <p>While <code>sops</code> provides the encryption, a \"Secret Provider\" in Ch-aOS answers the question: \"Where do you securely store the master key itself?\"</p> <p>Providers are integrations with external password managers (like Bitwarden and 1Password) that allow <code>chaos</code> to access master encryption keys (like <code>age</code> or <code>gpg</code> keys) without needing to keep them as plaintext files on the local filesystem.</p>"},{"location":"Advanced/providers/#the-ephemeral-key-workflow","title":"The Ephemeral Key Workflow","text":"<p>The primary benefit of using a provider is enabling an ephemeral key workflow.</p> <ol> <li> <p>The master key (e.g., your team's <code>age</code> private key) is stored securely in the password manager.</p> </li> <li> <p>When you run a command like <code>chaos apply --secrets -p bw.age</code>, <code>chaos</code> fetches that key from the provider.</p> </li> <li> <p>The key exists only in memory for the duration of that single command.</p> </li> <li> <p><code>sops</code> uses the in-memory key to decrypt your secrets file.</p> </li> <li> <p>Once the command finishes, the key is gone from your local machine.</p> </li> </ol> <p>This significantly enhances security by reducing the attack surface. An attacker would need to compromise your machine while a <code>chaos</code> command is running and also compromise your (likely locked) password manager.</p> <p>This workflow effectively transforms basic asimetric local-first keys into IAM keys. Just think about it, you abstract your private key's content into an versionable provider ID (e.g., bitwarden's IDs), this means you can 1 version control your private keys and 2 put an RBAC on top of them, and 3 audit the key's access through the same provider's auditability system which does the transformation's heavy lifting.</p>"},{"location":"Advanced/providers/#usage","title":"Usage","text":""},{"location":"Advanced/providers/#configuration","title":"Configuration","text":"<p>You can configure named providers in your global chaos configuration file at <code>~/.config/chaos/config.yml</code>.</p> <pre><code># ~/.config/chaos/config.yml\n\nsecret_providers:\n  # Sets the default provider to use when -p is given without a name\n  default: bw.age\n\n  bw:\n    age_id: \"BITWARDEN_ITEM_ID_FOR_AGE_KEY\"\n    gpg_id: \"BITWARDEN_ITEM_ID_FOR_GPG_KEY\"\n    # You can also specify organization/collection IDs for 'bw'\n    organization_id: \"...\"\n    collection_id: \"...\"\n\n  bws:\n    project_id: \"BITWARDEN_SECRETS_PROJECT_ID\"\n    age_id: \"SECRET_ID_FOR_AGE_KEY\"\n    gpg_id: \"SECRET_ID_FOR_GPG_KEY\"\n\n  op:\n    age_url: \"op://vault/item_name/notesPlain\"\n    gpg_url: \"op://vault/item_name/notesPlain\"\n</code></pre>"},{"location":"Advanced/providers/#ephemeral-usage","title":"Ephemeral Usage","text":"<p>Many commands that interact with secrets (like <code>apply</code>, <code>secrets edit</code>, <code>ramble read</code>) accept a <code>-p</code>/<code>--provider</code> flag to use a configured provider.</p> <pre><code># Use the provider named 'bw.age' from your config\nchaos apply users --secrets -p bw.age\n\n# Use the default provider\nchaos apply users --secrets -p\n</code></pre> <p>Most providers also register a direct flag (e.g., <code>-b</code> for Bitwarden, <code>-o</code> for 1Password) for one-off use without a pre-existing configuration.</p> <pre><code># Use a Bitwarden item directly\nchaos secrets edit -b \"ITEM_ID\" \"age\"\n</code></pre>"},{"location":"Advanced/providers/#supported-providers","title":"Supported Providers","text":"<p>Ch-aOS has built-in support for:</p> <ul> <li> <p>Bitwarden (<code>bw</code>, <code>rbw</code>): Integrates with the standard Bitwarden CLI (<code>bw</code> and <code>rbw</code>).</p> </li> <li> <p>Bitwarden Secrets (<code>bws</code>): Integrates with the Bitwarden Secrets Manager CLI (<code>bws</code>).</p> </li> <li> <p>1Password (<code>op</code>): Integrates with the 1Password CLI (<code>op</code>).</p> </li> </ul> <p>The provider system is extensible, allowing new plugins to add support for other backends.</p>"},{"location":"Advanced/providers/#import-export","title":"<code>import</code> / <code>export</code>","text":"<p>The <code>chaos secrets</code> command provides <code>import</code> and <code>export</code> subcommands to create a secure workflow for bootstrapping new machines or backing up master keys.</p>"},{"location":"Advanced/providers/#export","title":"<code>export</code>","text":"<p>Saves a local <code>age</code> or <code>gpg</code> master key into your chosen password manager.</p> <p>Example: <pre><code>chaos secrets export bw age --item-name 'My Team Age Key' --keys ~/.config/chaos/keys.txt\n</code></pre></p>"},{"location":"Advanced/providers/#import","title":"<code>import</code>","text":"<p>Retrieves a master key from the password manager and saves it to your local environment (e.g., importing it into your GPG keyring or saving it to <code>keys.txt</code>).</p> <p>Example: <pre><code>chaos secrets import bw age --item-id '...'\n</code></pre></p>"},{"location":"Advanced/providers/#enhanced-export-security-no-import","title":"Enhanced Export Security (<code>--no-import</code>)","text":"<p>When exporting a key, you can use the <code>-N</code> or <code>--no-import</code> flag. This embeds a special <code># NO-IMPORT</code> marker in the secret stored in the password manager. The <code>chaos secrets import</code> command will refuse to import any key with this marker. This creates a one-way-trip for a key, allowing it to be distributed for use but preventing it from being extracted back to a local file.</p>"},{"location":"Commands/apply/","title":"Command: <code>chaos apply</code>","text":"<p>Well duh, how is a \"system management tool\" supposed to manage your system if it can't apply changes?</p> <p>The <code>chaos apply</code> command is the engine of Ch-aOS. It executes roles to bring your system to the state declared in your Ch-obolo file.</p> <p>This implements a declarative state orchestration model. <code>pyinfra</code>, the underlying engine, first inspects the current state of the system (\"facts\"), compares it to the desired state, calculates the necessary changes (the \"delta\"), and then executes the operations to reconcile the state.</p>"},{"location":"Commands/apply/#usage","title":"Usage","text":"<pre><code>chaos apply [tags...] [options]\n</code></pre> <ul> <li> <p><code>[tags...]</code>: One or more tags corresponding to the roles you want to execute.</p> </li> <li> <p><code>[options]</code>: Flags to modify the command's behavior.</p> </li> </ul>"},{"location":"Commands/apply/#key-concepts-options","title":"Key Concepts &amp; Options","text":""},{"location":"Commands/apply/#tags-tags","title":"Tags (<code>[tags...]</code>)","text":"<p>Tags are the primary mechanism for selecting which roles to execute. You can specify one or more tags to run multiple roles in sequence. Plugins can also provide shorter aliases for tags.</p> <p>Why? They allow you to manage your system modularly. You can apply just the <code>users</code> configuration, or just <code>packages</code>, or both, without running your entire configuration every time.</p> <p>Example: <pre><code># Apply the configuration for users and packages\nchaos apply users packages\n\n# You can also use aliases defined by plugins\nchaos apply usr pkgs\n</code></pre></p>"},{"location":"Commands/apply/#ch-obolo-c-chobolo","title":"Ch-obolo (<code>-c</code>, <code>--chobolo</code>)","text":"<p>Specifies the path to the Ch-obolo file to be used for this operation. This overrides any default path configured with <code>chaos set chobolo</code>.</p> <p>Why? This provides flexibility, allowing you to use different configuration files for different environments or tasks without changing the global settings.</p>"},{"location":"Commands/apply/#secrets-s-secrets","title":"Secrets (<code>-s</code>, <code>--secrets</code>)","text":"<p>The <code>--secrets</code> flag signals to <code>chaos apply</code> that the role you are running needs access to decrypted data from your secrets file.</p> <p>Why? To securely provide sensitive data, like user passwords or private keys, to your orchestration logic without hardcoding them in your Ch-obolo. The decrypted secrets are held only in memory for the duration of the command.</p> <p>Example: <pre><code># The 'users' role requires passwords from the secrets file\nchaos apply users --secrets\n\n# Decrypt using an ephemeral key from a configured provider\nchaos apply users --secrets -p bw.age\n</code></pre></p>"},{"location":"Commands/apply/#dry-run-d-dry","title":"Dry Run (<code>-d</code>, <code>--dry</code>)","text":"<p>The <code>--dry</code> flag is an essential safety feature. It tells <code>chaos apply</code> to calculate and show all the changes it would make, but without actually executing them.</p> <p>Why? It allows you to preview and verify the impact of your configuration changes before applying them to your live system. It's a great way to learn what a role does and to ensure your changes are correct.</p> <p>Example: <pre><code># See what changes would be made for the 'packages' role\nchaos apply --dry packages\n\n# Combine with verbosity for more detail\nchaos apply -d -vvv packages\n</code></pre></p> <p>Note</p> <p>You NEED to have a \"secret_plugins\" section inside of your global config file (~/.config/chaos/config.yml) in order to use secrets inside of a specific role.</p>"},{"location":"Commands/apply/#fleet-mode-f-fleet","title":"Fleet Mode (<code>-f</code>, <code>--fleet</code>)","text":"<p>Applies the roles to a fleet of remote hosts defined in the Ch-obolo file instead of the local machine.</p> <p>See the Fleet Management documentation for more details.</p>"},{"location":"Commands/apply/#verbosity-v-vv-vvv-or-verbose","title":"Verbosity (<code>-v</code>, <code>-vv</code>, <code>-vvv</code> or <code>--verbose</code>)","text":"<p>Increases the verbosity of the output. This is useful for debugging and understanding what <code>pyinfra</code> is doing behind the scenes.</p> <ul> <li><code>-v</code>: Warning level</li> <li><code>-vv</code>: Info level</li> <li><code>-vvv</code>: Debug level</li> </ul>"},{"location":"Commands/apply/#skip-confirmation-y-i-know-what-im-doing","title":"Skip Confirmation (<code>-y</code>, <code>--i-know-what-im-doing</code>)","text":"<p>This flag skips all confirmation prompts during role execution. Use with caution.</p>"},{"location":"Commands/explain/","title":"Command: <code>chaos explain</code>","text":"<p>The <code>chaos explain</code> command provides a built-in documentation system. It offers a didactic way to learn about Ch-aOS concepts, commands, and features directly from the command line.</p> <p>The content is provided by plugins, meaning the documentation lives alongside the functionality it describes.</p>"},{"location":"Commands/explain/#usage","title":"Usage","text":"<pre><code>chaos explain [topic] [options]\n</code></pre> <ul> <li> <p><code>[topic]</code>: The topic you want an explanation for.</p> </li> <li> <p><code>[options]</code>: Flags to modify the command's behavior.</p> </li> </ul>"},{"location":"Commands/explain/#discovering-topics","title":"Discovering Topics","text":"<p>You can discover all available topics provided by your installed plugins using <code>chaos check</code>.</p> <pre><code>chaos check explanations\n</code></pre>"},{"location":"Commands/explain/#reading-explanations","title":"Reading Explanations","text":"<p>To read about a topic, simply pass its name to the command.</p> <pre><code># Get a basic explanation of the 'apply' command\nchaos explain apply\n</code></pre>"},{"location":"Commands/explain/#sub-topics","title":"Sub-topics","text":"<p>Many topics are broken down into more specific sub-topics. You can access them using a dot (<code>.</code>) notation.</p> <ul> <li> <p>To list all available sub-topics for a given topic, use <code>.list</code>.</p> </li> <li> <p>To read a specific sub-topic, use <code>topic.subtopic</code>.</p> </li> </ul> <p>Examples: <pre><code># List all sub-topics for the 'secrets' command\nchaos explain secrets.list\n\n# Get an explanation for the 'edit' subcommand of 'secrets'\nchaos explain secrets.edit\n</code></pre></p>"},{"location":"Commands/explain/#detail-level-d-details-c-complexity","title":"Detail Level (<code>-d</code>, <code>--details</code>, <code>-c</code>, <code>--complexity</code>)","text":"<p>You can request more detailed information using the <code>--details</code> flag. This allows you to progressively drill down from a high-level concept to technical specifics.</p> <p>You can also specify the complexity level of the explanation using the <code>--complexity</code> flag. This adjusts the depth and technicality of the content.</p> <p>The available levels are:</p> <ul> <li> <p><code>basic</code> (default)</p> </li> <li> <p><code>intermediate</code></p> </li> <li> <p><code>advanced</code></p> </li> </ul> <p>Example: <pre><code># Get an advanced explanation of sops integration, including technical details\nchaos explain secrets.sops --details advanced\n</code></pre></p>"},{"location":"Commands/management/","title":"Commands: Management","text":"<p>Well, Ch-aOS needs some way to manage itself, right? After all, it's not just about configuring other systems; you also need to set up and maintain the <code>chaos</code> CLI environment. I am sure that just installing a random CLI tool and it not providing any way to manage itself would be a pain, right?</p> <p>These commands help you manage the <code>chaos</code> CLI environment itself, from initializing configuration files to discovering available functionality.</p>"},{"location":"Commands/management/#chaos-init","title":"<code>chaos init</code>","text":"<p>The <code>chaos init</code> command is a setup wizard that creates boilerplate configuration files, lowering the barrier to entry by generating templates for you.</p>"},{"location":"Commands/management/#subcommands","title":"Subcommands","text":""},{"location":"Commands/management/#init-chobolo","title":"<code>init chobolo</code>","text":"<p>This command scans your installed plugins for their required configuration keys and generates a template <code>ch-obolo.yml</code> file. This is a great way to discover the data your roles need.</p> <p>Usage: <pre><code>chaos init chobolo\n</code></pre> This will create a <code>ch-obolo_template.yml</code> in <code>~/.config/chaos/</code>.</p>"},{"location":"Commands/management/#init-secrets","title":"<code>init secrets</code>","text":"<p>This command runs an interactive wizard to set up your secret management with <code>sops</code>. It helps you:</p> <ul> <li> <p>Choose between <code>age</code> and <code>gpg</code> as your encryption backend.</p> </li> <li> <p>Generate new keys or use existing ones.</p> </li> <li> <p>Create a <code>.sops.yaml</code> configuration file.</p> </li> <li> <p>Create an initial <code>secrets.yml</code> file.</p> </li> </ul> <p>Usage: <pre><code>chaos init secrets\n</code></pre></p>"},{"location":"Commands/management/#chaos-set","title":"<code>chaos set</code>","text":"<p>The <code>chaos set</code> command configures default paths for your most-used files, saving you from having to specify them with flags on every command. These paths are saved to <code>~/.config/chaos/config.yml</code>.</p>"},{"location":"Commands/management/#subcommands_1","title":"Subcommands","text":""},{"location":"Commands/management/#set-chobolo-path","title":"<code>set chobolo &lt;path&gt;</code>","text":"<p>Sets the default Ch-obolo file to use for <code>apply</code> operations.</p> <p>Usage: <pre><code>chaos set chobolo ~/my-chaos-configs/main-chobolo.yml\n</code></pre></p>"},{"location":"Commands/management/#set-secrets-path","title":"<code>set secrets &lt;path&gt;</code>","text":"<p>Sets the default secrets file.</p> <p>Usage: <pre><code>chaos set secrets ~/my-chaos-configs/secrets.sops.yml\n</code></pre></p>"},{"location":"Commands/management/#set-sops-path","title":"<code>set sops &lt;path&gt;</code>","text":"<p>Sets the default <code>.sops.yaml</code> configuration file.</p> <p>Usage: <pre><code>chaos set sops ~/my-chaos-configs/.sops.yaml\n</code></pre></p>"},{"location":"Commands/management/#chaos-check","title":"<code>chaos check</code>","text":"<p>The <code>chaos check</code> command helps you discover what functionality is available from your installed plugins.</p>"},{"location":"Commands/management/#subcommands_2","title":"Subcommands","text":""},{"location":"Commands/management/#check-roles","title":"<code>check roles</code>","text":"<p>Lists all available role tags that you can use with <code>chaos apply</code>.</p> <p>Usage: <pre><code>chaos check roles\n</code></pre></p>"},{"location":"Commands/management/#check-aliases","title":"<code>check aliases</code>","text":"<p>Lists all available command aliases for role tags.</p> <p>Usage: <pre><code>chaos check aliases\n</code></pre></p>"},{"location":"Commands/management/#check-explanations","title":"<code>check explanations</code>","text":"<p>Lists all documentation topics that you can read about with <code>chaos explain</code>.</p> <p>Usage: <pre><code>chaos check explanations\n</code></pre></p>"},{"location":"Commands/management/#check-providers","title":"<code>check providers</code>","text":"<p>Lists all available secret providers.</p> <p>Usage: <pre><code>chaos check providers\n</code></pre></p>"},{"location":"Commands/management/#check-boats","title":"<code>check boats</code>","text":"<p>Lists all available fleet boats.</p> <p>Usage: <pre><code>chaos check boats\n</code></pre></p>"},{"location":"Commands/ramble/","title":"Command: <code>chaos ramble</code>","text":"<p>The <code>ramble</code> subsystem is an integrated, file-based personal knowledge base or wiki system. It allows you to create, edit, search, and encrypt notes directly from the command line.</p> <p>Why? It's a convenient place to store technical notes, documentation, code snippets, and ideas co-located with your system management tools. Since notes can be encrypted with <code>sops</code>, it's also a safe place for sensitive information.</p> <p>Note that chaos ramble is completely intagrated with chaos team and chaos secrets, this makes the documentation something you can share with your team and all of you will be able to share the same versionated, encryptad and auditable documentation, all from inside the same CLI that helps you with your workflow.</p> <p>Rambles are organized into \"journals\" (directories) and \"pages\" (YAML files) within <code>~/.local/share/chaos/ramblings/</code>.</p>"},{"location":"Commands/ramble/#ramble-create","title":"<code>ramble create</code>","text":"<p>Creates a new ramble journal and/or page, then opens it in your default editor.</p> <p>Usage: <pre><code>chaos ramble create &lt;journal.page&gt;\n</code></pre></p> <ul> <li> <p>If you provide <code>journal.page</code>, it creates <code>page.yml</code> inside the <code>journal</code> directory.</p> </li> <li> <p>You can use the <code>-e</code> flag to encrypt the note immediately after creation.</p> </li> </ul> <p>Example: <pre><code># Create a new page 'networking' in the 'linux' journal\nchaos ramble create linux.networking\n\n# Create and encrypt a new page\nchaos ramble create security.passwords -e\n</code></pre></p>"},{"location":"Commands/ramble/#ramble-read","title":"<code>ramble read</code>","text":"<p>Displays the content of one or more ramble pages in a formatted, human-readable way. If the file is encrypted, it decrypts it in memory before displaying.</p> <p>Usage: <pre><code>chaos ramble read &lt;journal.page_or_list&gt;\n</code></pre></p> <ul> <li> <p>Use <code>journal.page</code> to read a specific page.</p> </li> <li> <p>Use <code>journal.list</code> to list all pages in a journal and be prompted to select one.</p> </li> </ul> <p>Example: <pre><code># Read a specific page\nchaos ramble read linux.networking\n</code></pre></p>"},{"location":"Commands/ramble/#ramble-edit","title":"<code>ramble edit</code>","text":"<p>Opens an existing ramble page in your default editor. If the file is encrypted, it uses <code>sops</code> to handle the decryption and re-encryption cycle automatically.</p> <p>Usage: <pre><code>chaos ramble edit &lt;journal.page&gt;\n</code></pre></p>"},{"location":"Commands/ramble/#ramble-find","title":"<code>ramble find</code>","text":"<p>Searches through the content of all your rambles for a specific keyword or tag. The search is case-insensitive and works on encrypted files.</p> <p>Usage: <pre><code># Find all rambles containing the word 'docker'\nchaos ramble find docker\n\n# Find all rambles that have the 'security' tag\nchaos ramble find --tag security\n</code></pre></p>"},{"location":"Commands/ramble/#ramble-encrypt","title":"<code>ramble encrypt</code>","text":"<p>Applies <code>sops</code> encryption to an existing, unencrypted ramble page.</p> <p>Usage: <pre><code>chaos ramble encrypt &lt;journal.page&gt; [-k key_to_encrypt]\n</code></pre></p> <p>By default, it encrypts most fields, but you can use the <code>-k</code> flag to specify exactly which YAML keys to encrypt.</p>"},{"location":"Commands/ramble/#ramble-update","title":"<code>ramble update</code>","text":"<p>Updates the encryption keys for all encrypted ramble files. This is necessary after you add or remove a key from your <code>.sops.yaml</code> configuration using <code>chaos secrets rotate-add/rm</code>.</p> <p>Usage: <pre><code>chaos ramble update\n</code></pre></p>"},{"location":"Commands/ramble/#ramble-move","title":"<code>ramble move</code>","text":"<p>Renames a page or moves it to a different journal.</p> <p>Usage: <pre><code># Rename a page\nchaos ramble move journal.old_name journal.new_name\n\n# Move a page to a different journal\nchaos ramble move old_journal.page new_journal.page\n</code></pre></p>"},{"location":"Commands/ramble/#ramble-delete","title":"<code>ramble delete</code>","text":"<p>Permanently removes a page or an entire journal after asking for confirmation.</p> <p>Usage: <pre><code># Delete a single page\nchaos ramble delete journal.page_to_delete\n\n# Delete an entire journal and all its pages\nchaos ramble delete journal\n</code></pre></p>"},{"location":"Commands/secrets/","title":"Command: <code>chaos secrets</code>","text":"<p>In real life, we don't use \"words\" to enter our homes, nor do we use them to enter establishments or offices. Instead, we use keys, keycards, or biometric data that are unique to us and difficult to replicate. For these reasons, Ch-aOS believes that \"passwords\" are an outdated and insecure method of protecting sensitive information.</p> <p>Because of this philosophy, Ch-aOS does not have a built-in password manager. Instead, it provides a robust interface for managing encrypted secrets using common tools, such as gpg and age, through Mozilla's <code>sops</code> utility.</p> <p>The <code>chaos secrets</code> command suite acts as an orchestrator for Mozilla's <code>sops</code> (Secrets OPerationS). It simplifies the entire workflow of managing encrypted secrets, allowing you to safely store sensitive data (like passwords, tokens, and API keys) in YAML files that can be committed to a Git repository.</p>"},{"location":"Commands/secrets/#secrets-edit","title":"<code>secrets edit</code>","text":"<p>Securely edits a secrets file. This command decrypts the file into a temporary buffer, opens it in your default text editor (<code>$EDITOR</code>), and automatically re-encrypts it when you save and close the editor.</p> <p>Why? It provides a seamless and secure workflow for editing secrets without ever permanently saving an unencrypted version to disk.</p> <p>Usage: <pre><code># Edit the default secrets file\nchaos secrets edit\n\n# Edit a specific secrets file for a team\nchaos secrets edit -t my-company.my-team\n</code></pre></p>"},{"location":"Commands/secrets/#secrets-print","title":"<code>secrets print</code>","text":"<p>Decrypts a secrets file and prints its entire contents to standard output.</p> <p>Usage: <pre><code>chaos secrets print\n</code></pre></p> <p>Security Risk</p> <p>Be careful where you use this command. The decrypted secrets will be visible on your screen and potentially in your shell history. Avoid using it in shared or untrusted environments.</p>"},{"location":"Commands/secrets/#secrets-cat","title":"<code>secrets cat</code>","text":"<p>Decrypts a secrets file and prints only the specific value(s) of the key(s) you ask for. This is more secure and convenient for scripting than <code>print</code>. Use dot notation to specify nested keys.</p> <p>Use the <code>-v</code> or <code>--value</code> flag to only print the value, without the key name or any formatting.</p> <p>Usage: <pre><code>chaos secrets cat user_secrets.dex.password -v\n</code></pre></p>"},{"location":"Commands/secrets/#key-management","title":"Key Management","text":""},{"location":"Commands/secrets/#secrets-rotate-add","title":"<code>secrets rotate-add</code>","text":"<p>Adds a new encryption key (e.g., a GPG fingerprint or an <code>age</code> public key) to your <code>.sops.yaml</code> configuration. This is how you grant a new person or machine access to the secrets.</p> <p>Usage: <pre><code># Add a new GPG key to the sops configuration\nchaos secrets rotate-add pgp 'FINGERPRINT_OF_NEW_USER'\n\n# Add a new age key\nchaos secrets rotate-add age 'age1...'\n</code></pre></p> <p>After adding a key, you must run <code>sops updatekeys</code> (or use the <code>-u</code> flag with <code>rotate-add</code>) on your secret files to re-encrypt them.</p>"},{"location":"Commands/secrets/#secrets-rotate-rm","title":"<code>secrets rotate-rm</code>","text":"<p>Removes a key from your <code>.sops.yaml</code> configuration, revoking access for that key. This is a critical step when someone leaves a team or a machine is decommissioned.</p> <p>Usage: <pre><code>chaos secrets rotate-rm pgp 'FINGERPRINT_TO_REMOVE'\n</code></pre></p> <p>Like <code>rotate-add</code>, you must update the files afterward to apply the key removal.</p>"},{"location":"Commands/secrets/#secrets-shamir","title":"<code>secrets shamir</code>","text":"<p>Configures Shamir's Secret Sharing, creating an \"M-of-N\" policy where <code>M</code> out of <code>N</code> total keys are required to decrypt a secret.</p> <p>Why? It builds redundancy (preventing a single point of failure if a key is lost) and can be used to require a quorum for highly sensitive data.</p> <p>Usage: <pre><code># Set the first (index 0) rule in .sops.yaml to require 2 keys to decrypt\nchaos secrets shamir 0 2\n</code></pre></p>"},{"location":"Commands/secrets/#secrets-importexport","title":"<code>secrets import</code>/<code>export</code>","text":"<p>These commands allow you to securely transfer master keys to and from external password managers. See Secret Providers for more details.</p>"},{"location":"Commands/styx/","title":"Command <code>chaos styx</code>","text":"<p>The <code>chaos styx</code> command is used to manage and interact with the Styx plugin registry.</p> <p>This command allows you to install (<code>invoke</code>), list (<code>list</code>), and remove (<code>destroy</code>) plugins that extend the functionality of Ch-aOS.</p>"},{"location":"Commands/styx/#usage","title":"Usage","text":"<pre><code>chaos styx &lt;action&gt; [plugin_name]\n</code></pre> <ul> <li> <p><code>&lt;action&gt;</code>: The operation you want to perform. It can be one of the following:</p> </li> <li> <p><code>invoke</code>: Install a plugin.</p> </li> <li> <p><code>list</code>: List all installed plugins.</p> </li> <li> <p><code>destroy</code>: Remove an installed plugin.</p> </li> </ul>"},{"location":"Commands/styx/#sending-a-plugin-to-styx","title":"Sending a Plugin to Styx","text":"<p>If you have created a plugin in Ch-aOS, and would like to share it with the community via Styx, please open a PR on the Styx GitHub repository</p> <p>It is quite simply a dict of dicts in a yaml file with the following structure: <pre><code>styx: # global dict\n  chaos-dots: # name of your plugin\n    name: chaos-dots # name that you builded you plugin with\n    repo: https://github.com/Ch-aOS-Ch/chaos-dots # the git repo where your plugin is hosted\n    about: \"A Ch-aotic dotfile manager, full with declarativity and statefulness\" # a brief description about your plugin\n    version: \"v0.1.1\" # the version of your plugin, cannot be \"latest\", be specific\n</code></pre></p> <p>Important</p> <p>Styx was created to be simple, it is NOT a package manager. It was created from the start to be as simple as possible (either you have the plugin, or not), it is a plugin registry, managed and contributed by the community. There should NOT be a \"chaos-utils\" inside of styx, since plugins should be auto contained solutions. All of the tools for creating an auto contained solution for Ch-aOS are available and should be used. PyPI managed utilities are not only recommended, they are the correct way to distribute an utils package for styx plugins. Plugins may use any PyPI package, but it is required to have undergone an \"pip-audit\" run before the styx installation.</p>"},{"location":"Commands/styx/#about-security","title":"About security:","text":"<p>ATTENTION, THIS IS IMPORTANT.</p> <p>ALL styx plugins NEED to be reviewed by a member of the \"Reviewers Styx\" team and be open source in order to be added to the styx registry.</p> <p>ALL plugins should be submitted with a proper LICENSE file, and a proper SECURITY.md file.</p> <p>ALL plugins should be added with a SIGNED COMMIT AND PR. No Plugins will be accepted without such.</p> <p>All plugins are installed via the repo url provided in the styx registry only download a .whl file with the \"this_name-version-py3-none-any.whl\" format.</p> <p>All plugins are installed in the user's home directory, and should have documentation about if they require elevated permissions OR if they require secrets access.</p> <p>The main branch of the repo is always protected, and all PRs are reviewed before being merged (the repo is public, so anyone can review PRs) (ONLY exception are plugins created by the Ch-aOS team themselves).</p>"},{"location":"Commands/team/","title":"Command: <code>chaos team</code>","text":"<p>Wow, you made a massive role that uses secrets and documented it for your team on encrypted rambles about which keys to use where? Cool... now... how do you share that with your team?</p> <p>The <code>team</code> subsystem provides a structured way to manage and share Ch-aOS configurations (like secrets and rambles) within a team using Git repositories. It enables collaboration by providing a central, version-controlled repository for team-wide settings.</p> <p>A team repository is a standard Git repository with a specific directory structure (<code>secrets/</code>, <code>ramblings/</code>) and a <code>.chaos.yml</code> file for metadata.</p>"},{"location":"Commands/team/#team-init","title":"<code>team init</code>","text":"<p>Initializes the standard directory structure and configuration files for a new team repository in the current directory (or a specified path).</p> <p>Usage: <pre><code>chaos team init &lt;company.team.person&gt; [path]\n</code></pre></p> <ul> <li> <p>It generates a <code>.chaos.yml</code> file defining the team's metadata.</p> </li> <li> <p>It creates a <code>sops-config.yml</code> with secure defaults for team secrets (using Shamir's Secret Sharing).</p> </li> <li> <p>It creates the <code>secrets/</code> and <code>ramblings/</code> directories.</p> </li> <li> <p>It initializes a Git repository if one is not already present.</p> </li> </ul> <p>Example: <pre><code># Initialize a repository for a person on a team\nchaos team init my-company.my-team.dex\n\n# Initialize in a specific path\nchaos team init my-company.my-team.dex ./team-repo\n</code></pre></p>"},{"location":"Commands/team/#team-clone","title":"<code>team clone</code>","text":"<p>Clones an existing team repository from a Git URL and automatically activates it. This is the standard way for a new team member to join a project.</p> <p>Usage: <pre><code>chaos team clone &lt;git_repo_url&gt;\n</code></pre></p> <p>It performs a <code>git clone</code> and then runs the <code>activate</code> logic on the newly cloned directory.</p> <p>Danger</p> <p>If the cloned repository does not have a valid <code>.chaos.yml</code> file, the activation step will fail, and <code>chaos</code> will remove the cloned directory to prevent misconfiguration.</p>"},{"location":"Commands/team/#team-activate","title":"<code>team activate</code>","text":"<p>Registers a local team repository with your Ch-aOS environment. This is useful if you have cloned a repository manually.</p> <p>Usage: <pre><code># Activate the team repo in the current directory\nchaos team activate\n\n# Activate a team repo in a specific directory\nchaos team activate ./path/to/repo\n</code></pre></p> <p>This command reads the <code>.chaos.yml</code> file and creates a symlink from <code>~/.local/share/chaos/teams/&lt;company&gt;/&lt;team&gt;</code> to your local repository path. This makes the team available for commands like <code>chaos apply -t my-company.my-team ...</code>.</p>"},{"location":"Commands/team/#team-deactivate","title":"<code>team deactivate</code>","text":"<p>Un-registers a team from your local Ch-aOS environment by removing its symlink. This is useful for cleaning up your environment without deleting the repository itself.</p> <p>Usage: <pre><code># Deactivate a specific team\nchaos team deactivate &lt;company&gt; &lt;team&gt;\n\n# Deactivate all teams for a company\nchaos team deactivate &lt;company&gt;\n</code></pre></p>"},{"location":"Commands/team/#team-list","title":"<code>team list</code>","text":"<p>Shows all the teams that are currently activated on your machine.</p> <p>Usage: <pre><code># List all active companies and teams\nchaos team list\n\n# List all teams for a specific company\nchaos team list &lt;company&gt;\n</code></pre></p>"},{"location":"Commands/team/#team-prune","title":"<code>team prune</code>","text":"<p>Cleans up your activation directory (<code>~/.local/share/chaos/teams/</code>) by removing \"stale\" symlinks that point to non-existent directories. This is useful if you have manually deleted a team repository from your filesystem without running <code>deactivate</code>.</p> <p>Usage: <pre><code>chaos team prune\n</code></pre></p>"},{"location":"Plugins/connectors/","title":"Developing Pyinfra Connectors","text":"<p>So, Pyinfra's connectors have some things going on for them, mainly, their base.</p>"},{"location":"Plugins/connectors/#first-things-first","title":"First things first:","text":"<p>Let's start in parts, firstly, the <code>ConnectorData</code></p> <p>This is a Python object with one singular objective: store all data that can be defined inside your Connector.</p> <p>Ssh connector example: <pre><code>class ConnectorData(TypedDict):\n    ssh_hostname: str\n    ssh_port: int\n    ssh_user: str\n    ssh_password: str\n    ssh_key: str\n    ssh_key_password: str\n\n    ssh_allow_agent: bool\n    ssh_look_for_keys: bool\n    ssh_forward_agent: bool\n\n    ssh_config_file: str\n    ssh_known_hosts_file: str\n    ssh_strict_host_key_checking: str\n\n    ssh_paramiko_connect_kwargs: dict\n\n    ssh_connect_retries: int\n    ssh_connect_retry_min_delay: float\n    ssh_connect_retry_max_delay: float\n    ssh_file_transfer_protocol: str\n</code></pre></p> <p>This gets loaded by the BaseConnector through the line: <pre><code>data_cls: Type = ConnectorData\n</code></pre></p> <p>This translating to Ch-aOS's fleets: <pre><code>fleet:\n  hosts:\n   - \"@ssh/my_server.net\": # You can omit the \"@ssh/\"\n      ssh_hostname: str\n      ssh_port: str\n      ...: ...\n</code></pre></p> <p>As you can see, Its a perfect match!</p>"},{"location":"Plugins/connectors/#meta-shtuff","title":"Meta shtuff","text":"<p>The <code>DataMeta</code> class is a simple auto documenting class/default values handler... quite Ch-aOtic of them to add a feature like this huh?</p> <pre><code>class DataMeta:\n    description: str\n    default: Any\n\n    def __init__(self, description, default=None) -&gt; None:\n        self.description = description\n        self.default = default\n</code></pre> <p>Pyinfra's ssh object example of usage: <pre><code>connector_data_meta: dict[str, DataMeta] = {\n    \"ssh_hostname\": DataMeta(\"SSH hostname\"),\n    \"ssh_port\": DataMeta(\"SSH port\"),\n    \"ssh_user\": DataMeta(\"SSH user\"),\n    \"ssh_password\": DataMeta(\"SSH password\"),\n    \"ssh_key\": DataMeta(\"SSH key filename\"),\n    \"ssh_key_password\": DataMeta(\"SSH key password\"),\n    \"ssh_allow_agent\": DataMeta(\n        \"Whether to use any active SSH agent\",\n        True,\n    ),\n# Other ConnectorData descriptions and default values\n</code></pre></p>"},{"location":"Plugins/connectors/#the-juicy-part","title":"The juicy part","text":"<p>Now... the BaseConnector part... this is the most complex part of them, but it is quite important.</p> <p>This is the complete object:</p> <pre><code>class BaseConnector(abc.ABC):\n    state: \"State\"\n    host: \"Host\"\n\n    handles_execution = False\n\n    data_cls: Type = ConnectorData\n    data_meta: dict[str, DataMeta] = {}\n\n    def __init__(self, state: \"State\", host: \"Host\"):\n        self.state = state\n        self.host = host\n        self.data = host_to_connector_data(self.data_cls, self.data_meta, host.data)\n\n    @staticmethod\n    @abc.abstractmethod\n    def make_names_data(name: str) -&gt; Iterator[tuple[str, dict, list[str]]]:\n        \"\"\"\n        Generate inventory targets. This is a staticmethod because each yield will become a new host\n        object with a new (ie not this) instance of the connector.\n        \"\"\"\n\n    def connect(self) -&gt; None:\n        \"\"\"\n        Connect this connector instance. Should raise ConnectError exceptions to indicate failure.\n        \"\"\"\n\n    def disconnect(self) -&gt; None:\n        \"\"\"\n        Disconnect this connector instance.\n        \"\"\"\n\n    @abc.abstractmethod\n    def run_shell_command(\n        self,\n        command: \"StringCommand\",\n        print_output: bool,\n        print_input: bool,\n        **arguments: Unpack[\"ConnectorArguments\"],\n    ) -&gt; tuple[bool, \"CommandOutput\"]:\n        \"\"\"\n        Execute a command.\n\n        Args:\n            command (StringCommand): actual command to execute\n            print_output (bool): whether to print command output\n            print_input (bool): whether to print command input\n            arguments: (ConnectorArguments): connector global arguments\n\n        Returns:\n            tuple: (bool, CommandOutput)\n            Bool indicating success and CommandOutput with stdout/stderr lines.\n        \"\"\"\n\n    @abc.abstractmethod\n    def put_file(\n        self,\n        filename_or_io: Union[str, IOBase],\n        remote_filename: str,\n        remote_temp_filename: Optional[str] = None,\n        print_output: bool = False,\n        print_input: bool = False,\n        **arguments: Unpack[\"ConnectorArguments\"],\n    ) -&gt; bool:\n        \"\"\"\n        Upload a local file or IO object by copying it to a temporary directory\n        and then writing it to the upload location.\n\n        Returns:\n            bool: indicating success or failure.\n        \"\"\"\n\n    @abc.abstractmethod\n    def get_file(\n        self,\n        remote_filename: str,\n        filename_or_io: Union[str, IOBase],\n        remote_temp_filename: Optional[str] = None,\n        print_output: bool = False,\n        print_input: bool = False,\n        **arguments: Unpack[\"ConnectorArguments\"],\n    ) -&gt; bool:\n        \"\"\"\n        Download a local file by copying it to a temporary location and then writing\n        it to our filename or IO object.\n\n        Returns:\n            bool: indicating success or failure.\n        \"\"\"\n\n    def check_can_rsync(self) -&gt; None:\n        raise NotImplementedError(\"This connector does not support rsync\")\n\n    def rsync(\n        self,\n        src: str,\n        dest: str,\n        flags: Iterable[str],\n        print_output: bool = False,\n        print_input: bool = False,\n        **arguments: Unpack[\"ConnectorArguments\"],\n    ) -&gt; bool:\n        raise NotImplementedError(\"This connector does not support rsync\")\n</code></pre> <p>As you can see... quite the big amount of code. Good for you (not me), I've spent my time reading the source code for Pyinfra extensively!</p> <p>You don't need to touch <code>state</code> or <code>host</code>.</p> <p><code>handles_execution</code> Is a simple bool that answers the question \"Can your connector handle command execution?\". Quite important for different systems.</p> <p><code>data_cls</code> again, just the data for your connector.</p> <p><code>data_meta</code> a dict of <code>DataMeta</code>s to document and set default values</p> <p>First method: <code>make_names_data</code> is like Provider's <code>get_cli_name</code>, it simply yields the tag for your connector.</p> <p>Pyinfra's ssh example: <pre><code>    @override\n    @staticmethod\n    def make_names_data(name):\n        yield \"@ssh/{0}\".format(name), {\"ssh_hostname\": name}, [] # transforms the name part into an @ssh/{name} and turns \"ssh_hostname\" into {name}\n</code></pre></p> <p>Some other methods that are well documented (<code>connect</code>, <code>disconnect</code>)</p> <p><code>run_shell_command</code> has one exact quirk to it: <code>**arguments</code>. This receives a <code>ConnectorArguments</code> object, which is the basic global arguments (<code>_sudo</code>, <code>_doas</code>, etc), which can be handled by you however you please, pyinfra's ssh object uses lines like <code>_stdin = arguments.pop(\"_stdin\", None)</code>. It should return a <code>CommandOutput</code> object, which is, again, a simple object that can return each output, stdout and stderr from your connector, both as a list and as a singular, unified string.</p> <p>These behaviours should be the same accross all other methods until <code>check_can_rsync</code> and <code>rsync</code> which... well, they do exactly what the name suggests.</p> <p>I quite recommend you to check the Connectors inside of pyinfra's source code, they can teach you quite a lot. Also, I do recommend looking at their documentation for more details and examples!</p>"},{"location":"Plugins/connectors/#quirks-tips-and-shticks-worth-pointing-out","title":"Quirks, Tips and Shticks worth pointing out","text":"<p>Firstly: On a connection failed, make sure to raise a <code>ConnectError</code> exception, Pyinfra will catch it and handle it properly.</p> <p>Secondly: <code>make_names_data</code> is a staticmethod, meaning you can't access <code>self</code> or any instance variables inside of it. This is because each yield will create a new instance of your connector.</p> <p>To \"get\" data inside of <code>make_names_data</code>, you need to do outside functions, like documented in their official docs: <pre><code>def load_settings():\n  settings = {}\n  # logic here\n  return settings\n\nclass InventoryConnector(BaseConnector):\n  api_instance = external.ApiClient()\n  ...\n\n  @staticmethod\n  def make_names_data(_=None)\n    api_client = getattr(InventoryConnector, 'api_instance')\n    api_settings = load_settings()\n    ...\n</code></pre></p> <p>3: About <code>run_shell_command</code>, You should use their official function <code>make_unix_command_for_host()</code> and <code>extract_control_commands()</code> from <code>pyinfra.connectors.util</code> to properly handle control commands like <code>_sudo</code>, <code>_doas</code>, etc. Official example: <pre><code>    control_commands = extract_control_commands(arguments) # returns a dict of control commands\n    wrapped_command = make_unix_command_for_host(\n        self.state,\n        self.host,\n        command,\n        **arguments, # Be sure to pass ARGUMENTS, not control_commands\n    )\n\n    timeout = control_commands.get(\"_timeout\")\n    success_exit_codes = control_commands.get(\"_success_exit_codes\", [0])\n    exit_code, output = self._execute(wrapped_command, timeout=timeout)\n\n    success = exit_code in success_exit_codes\n    return success, output\n</code></pre></p> <p>This is because Pyinfra has a lot of built-in logic to handle these control commands, and you should leverage that instead of re-inventing the wheel.</p> <p>Also it parses commands correctly which ensures that these run correctly on the target system.</p>"},{"location":"Plugins/connectors/#how-are-them-different-from-ch-aos-boats","title":"How are them different from Ch-aOS' Boats?","text":"<p>Well, quite a lot actually. Boats provide you with dynamic inventories, Pyinfra Connectors provide you with connection methods, which are quite different things. Both can be used together in harmony, Boats can provide dynamic inventories that use different Connectors for different hosts, providing you with a lot of flexibility and power!</p>"},{"location":"Plugins/development/","title":"Plugin Development","text":"<p>The <code>chaos</code> CLI is designed to be minimal and modular. Most functionality is provided through external plugins. This guide covers the basics of creating your own plugin.</p> <p>A plugin is a standard Python package that uses entry points to register its functionality with <code>chaos</code>.</p>"},{"location":"Plugins/development/#project-structure","title":"Project Structure","text":"<p>A basic plugin has the following structure:</p> <pre><code>my-chaos-plugin/\n\u251c\u2500\u2500 pyproject.toml\n\u2514\u2500\u2500 src/\n    \u2514\u2500\u2500 my_chaos_plugin/\n        \u251c\u2500\u2500 __init__.py\n        \u251c\u2500\u2500 roles.py\n        \u2514\u2500\u2500 explain.py\n</code></pre>"},{"location":"Plugins/development/#pyprojecttoml","title":"<code>pyproject.toml</code>","text":"<p>The <code>pyproject.toml</code> file is where you define your plugin's metadata and, most importantly, its entry points.</p> <pre><code>[project]\nname = \"my-chaos-plugin\"\nversion = \"0.1.0\"\ndescription = \"A new plugin for Ch-aOS.\"\nrequires-python = \"&gt;=3.10\"\n\n[project.entry-points]\n# Entry points are defined here\n\"chaos.roles\" = { my-role = \"my_chaos_plugin.roles:my_role_function\" }\n\"chaos.explain\" = { my-role = \"my_chaos_plugin.explain:MyRoleExplain\" }\n\"chaos.aliases\" = { mr = \"my-role\" }\n\"chaos.keys\" = { my-role = \"my_chaos_plugin.roles:my_role_keys\" }\n\"chaos.providers\" = { myprovider = \"my_chaos_plugin.providers:MyProviderClass\" }\n\"chaos.boats\" = { myboat = \"my_chaos_plugin.boats:MyBoatClass\" }\n\"chaos.limanis\" = { mylimani = \"my_chaos_plugin.limanis:MyLimaniClass\" }\n</code></pre>"},{"location":"Plugins/development/#entry-points","title":"Entry Points","text":"<p>Ch-aOS uses several entry point groups to discover plugin functionality.</p>"},{"location":"Plugins/development/#chaosroles","title":"<code>chaos.roles</code>","text":"<p>This is the most important entry point. It registers a role that can be executed with <code>chaos apply</code>.</p> <ul> <li>Key: The name of the role tag (e.g., <code>my-role</code>).</li> <li>Value: A string pointing to a Python function in the format <code>path.to.module:function_name</code>.</li> </ul> <p>This function will be called by <code>chaos</code> and should contain your <code>pyinfra</code> operations.</p> <p>Example <code>roles.py</code>: <pre><code>from pyinfra.operations import server\n\ndef my_role_function(state, host, chobolo_path, skip_confirm):\n    \"\"\"\n    A simple role that ensures a directory exists.\n    \"\"\"\n    # In a real role, you would load data from the chobolo_path\n    # from omegaconf import OmegaConf\n    # config = OmegaConf.load(chobolo_path)\n    # my_dirs = config.get('my_role_dirs', [])\n\n    server.dir(\n        name=\"Ensure /tmp/my-role-dir exists\",\n        path=\"/tmp/my-role-dir\",\n        present=True,\n        user=\"root\",\n        mode=\"755\",\n    )\n</code></pre></p>"},{"location":"Plugins/development/#chaosexplain","title":"<code>chaos.explain</code>","text":"<p>Registers a class that provides documentation for your role, accessible via <code>chaos explain</code>.</p> <ul> <li> <p>Key: The topic name, which should usually match your role's tag (e.g., <code>my-role</code>).</p> </li> <li> <p>Value: A string pointing to a Python class in the format <code>path.to.module:ClassName</code>.</p> </li> </ul> <p>The class should contain methods named <code>explain_&lt;subtopic&gt;</code> that return a dictionary with the explanation content.</p> <p>Example <code>explain.py</code>: <pre><code>class MyRoleExplain:\n    _order = ['usage'] # Controls the order in `explain my-role.list`\n\n    def explain_my_role(self, detail_level='basic'):\n        return {\n            'concept': 'My Custom Role',\n            'what': 'This role ensures a specific directory exists.',\n            'why': 'To demonstrate how to create a Ch-aOS plugin.',\n            'how': 'It uses the `server.dir` operation from pyinfra.',\n        }\n\n    def explain_usage(self, detail_level='basic'):\n        return {\n            'concept': 'Usage Example',\n            'examples': [{\n                'yaml': '# Run the role\\nchaos apply my-role'\n            }]\n        }\n</code></pre></p>"},{"location":"Plugins/development/#chaosaliases","title":"<code>chaos.aliases</code>","text":"<p>Registers a shorter alias for a role tag.</p> <ul> <li> <p>Key: The alias (e.g., <code>mr</code>).</p> </li> <li> <p>Value: The full role tag it points to (e.g., <code>my-role</code>).</p> </li> </ul> <p>Now you can run <code>chaos apply mr</code> instead of <code>chaos apply my-role</code>.</p>"},{"location":"Plugins/development/#chaoskeys","title":"<code>chaos.keys</code>","text":"<p>Registers the configuration keys that your role uses. This allows <code>chaos init chobolo</code> to automatically include them in the generated template.</p> <ul> <li> <p>Key: The name of the role tag (e.g., <code>my-role</code>).</p> </li> <li> <p>Value: A string pointing to a Python object (usually a list of dictionaries) in the format <code>path.to.module:object_name</code>.</p> </li> </ul> <p>Example <code>roles.py</code>: <pre><code># ... (imports and my_role_function)\n\n# This is the object that will be exposed to `chaos init chobolo`\nmy_role_keys = [{\n    'my_role_dirs': [\n        '/tmp/dir1',\n        '/tmp/dir2',\n    ]\n}]\n</code></pre></p>"},{"location":"Plugins/development/#chaosproviders","title":"<code>chaos.providers</code>","text":"<p>Registers a new secret provider. This is a more advanced topic that requires implementing a class that inherits from the base <code>Provider</code> class. See Plugin Providers for examples.</p>"},{"location":"Plugins/development/#chaosboats","title":"<code>chaos.boats</code>","text":"<p>Registers a new boat for use with <code>chaos apply --fleet</code>. This is an advanced topic for managing fleets of hosts. See Boat Plugins for more details.</p>"},{"location":"Plugins/development/#chaoslimanis","title":"chaos.limanis","text":"<p>Enables a new database to use with <code>chaos apply --logbook --limani</code>. This is an advanced topic for logging operations. See Limani Plugins for more information.</p>"},{"location":"Plugins/limani/","title":"Ch-aOS Limani Plugin","text":"<p>So, the Ch-aOS Logbook is great and all, but what if you want to take it a step further? What if you need to store it in a better format like a database, or maybe you want to visualize it in a fancy dashboard? That's where the Limani plugin comes in!</p> <p>Limanis are the greek word for \"harbors\", and just like a harbor is a safe place for ships to dock, the Limani plugin provides a safe place for your logbook data to dock and be managed.</p> <p>Limanis are purely optional plugins that simply add a database for your Logbook data. You can choose one Limani plugin to use in each <code>chaos apply --logbook --limani &lt;limani&gt;</code> command.</p>"},{"location":"Plugins/limani/#why","title":"Why?","text":"<p>Well, the default Logbook stores data in a simple SQLite database (through the Ch-rima Limani) which is great for small-scale use, but if you're running a larger operation or need more advanced features, you might want to consider using a different Limani plugin.</p>"},{"location":"Plugins/limani/#how-to-use","title":"How to use?","text":"<p>Simply install the Limani plugin of your choice, and then use the <code>--limani &lt;limani&gt;</code> flag when applying your logbook. For example, if you wanted to use the Ch-aOS PostgreSQL Limani, you would run <code>chaos apply &lt;tags&gt; --logbook --limani chaos-limani-postgresql</code>, easy as that!</p>"},{"location":"Plugins/limani/#now-the-juicy-part-developing-your-own-limani-plugin","title":"Now the juicy part: Developing your own Limani plugin","text":"<p>You see, a plugin system without a good interface is not a real plugin system, is it? So, to make sure that all Limani plugins play nicely together, we've defined a simple interface that all Limani plugins must implement.</p> <p>Here's the base Limani abstract class that all Limani plugins must inherit from:</p> <pre><code>from abc import ABC, abstractmethod\n\nclass Limani(ABC):\n    \"\"\"\n    Abstract base class for Limani implementations.\n\n    Limanis are responsible for connecting to, setting, getting and disconnecting\n    From databases or other data sources.\n\n    They are meant to give an endpoint-agnostic interface to the Logbook system.\n\n    The Logbook should _require_ a Limani to be used as its data source.\n\n    The Limanis should be easily pluggable, so that different data sources can be used.\n    Also, the only abstract methods should be required to be implemented by the subclasses.\n\n    The only abstract methods required are connect, disconnect, set, get, export, init_db.\n    \"\"\"\n\n    def __init__(self, config: dict):\n        \"\"\"\n        Initialize the Limani with the given configuration.\n\n        :param config: A dictionary containing configuration parameters.\n        \"\"\"\n        self.config = config or {}\n        self.werehouse = config.get(\"werehouse\", \"\")\n\n    @abstractmethod\n    def connect(self):\n        \"\"\"\n        Connect to the data source.\n\n        MUST return a connection object or similar.\n        \"\"\"\n        raise NotImplementedError\n\n    @abstractmethod\n    def disconnect(self):\n        \"\"\"Disconnect from the data source.\"\"\"\n        raise NotImplementedError\n\n    @abstractmethod\n    def end_run_update(self, run_id: str, end_time: float, status: str, summary: dict) -&gt; None:\n        \"\"\"\n        This method should update a run at the end with final status, time, and summary.\n\n        :param run_id: The ID of the run to update.\n        :param end_time: The end time of the run.\n        :param status: The final status of the run.\n        :param summary: The summary of the run.\n        \"\"\"\n\n        raise NotImplementedError\n\n    @abstractmethod\n    def start_update_run(self, run_id: str, status: str) -&gt; None:\n        \"\"\"\n        This method should update the status of a run in the data source.\n\n        :param run_id: The ID of the run to update.\n        :param status: The new status of the run.\n        \"\"\"\n        raise NotImplementedError\n\n    @abstractmethod\n    def insert_fact_log(self, run_id: str, timestamp: float, log_level: str, context: str, command: str) -&gt; None:\n        \"\"\"\n        This method should insert a fact log into the data source.\n\n        :param run_id: The ID of the run the fact log belongs to.\n        :param timestamp: The timestamp of the fact log.\n        :param log_level: The log level of the fact log.\n        :param context: The context of the fact log.\n        :param command: The command of the fact log.\n\n        \"\"\"\n        raise NotImplementedError\n\n    @abstractmethod\n    def insert_operation(self, run_id: str, host_id: int, op_hash: str, name: str, changed: bool, success: bool, duration: float, timestamp: float, logs: dict, diff: str, arguments: dict, retry_stats: dict, command_n_facts: list) -&gt; None:\n        \"\"\"\n        This method should insert an operation into the data source.\n\n        :param run_id: The ID of the run the operation belongs to.\n        :param host_id: The ID of the host the operation belongs to.\n        :param op_hash: The hash of the operation.\n        :param name: The name of the operation.\n        :param changed: Whether the operation changed anything.\n        :param success: Whether the operation was successful.\n        :param duration: The duration of the operation.\n        :param timestamp: The timestamp of the operation.\n        :param logs: The logs of the operation.\n        :param diff: The diff of the operation.\n        :param arguments: The arguments of the operation.\n        :param retry_stats: The retry stats of the operation.\n        :param command_n_facts: The command and facts associated with the operation.\n        \"\"\"\n\n        raise NotImplementedError\n\n    @abstractmethod\n    def insert_snapshot(self, run_id: str, host_id: int, stage: str, timestamp: float, metrics: dict) -&gt; None:\n        \"\"\"\n        This method should insert a resource snapshot into the data source.\n\n        :param run_id: The ID of the run the snapshot belongs to.\n        :param host_id: The ID of the host the snapshot belongs to.\n        :param stage: The stage of the snapshot.\n        :param timestamp: The timestamp of the snapshot.\n        :param metrics: The metrics of the snapshot.\n        \"\"\"\n\n        raise NotImplementedError\n\n    @abstractmethod\n    def create_run(self, run_id: str, run_id_human: str, start_time: float, hailer_info: dict) -&gt; str:\n        \"\"\"\n        Creates a new run entry in the database.\n\n        :param run_id: The ID of the run.\n        :param run_id_human: The human-readable ID of the run.\n        :param start_time: The start time of the run.\n        :param hailer_info: The hailer information of the run.\n\n        :return: The ID of the created run.\n        \"\"\"\n\n    @abstractmethod\n    def init_db(self):\n        \"\"\"\n        Initialize the data source.\n\n        This should create any necessary tables or structures in the data source.\n        This should only create if not exists.\n        \"\"\"\n        raise NotImplementedError\n\n    @abstractmethod\n    def get_or_create_host(self, run_id: str, host_name: str) -&gt; int:\n        \"\"\"\n        Specific method to get or create a host in the data source, this one does two things.\n\n        :param run_id: The ID of the host the host belongs to.\n        :param host_name: The name of the host to get or create.\n\n        :return: The ID of the host.\n\n        Should be idempotent.\n        \"\"\"\n\n    @abstractmethod\n    def get_run_data(self, run_id: str):\n        \"\"\"\n        Get all data for a given run.\n        :param run_id: The ID of the run to get data for.\n        :return: A dictionary containing all data for the run.\n        \"\"\"\n        raise NotImplementedError\n\n    @abstractmethod\n    def get_facts_for_timespan(self, run_id: str, start_time: float, end_time: float) -&gt; list[dict]:\n        \"\"\"\n        Get all facts for a given run within a specific time span.\n\n        :param run_id: The ID of the run to get facts for.\n        :param start_time: The start time of the time span.\n        :param end_time: The end time of the time span.\n\n        :return: A list of fact logs within the specified time span.\n        \"\"\"\n\n        raise NotImplementedError\n\n    @abstractmethod\n    def get_run_summary_stats(self, run_id: str) -&gt; dict:\n        \"\"\"\n        Get summary statistics for a given run.\n\n        :param run_id: The ID of the run to get summary statistics for.\n\n        :return: A dictionary containing summary statistics for the run.\n        \"\"\"\n        raise NotImplementedError\n</code></pre> <p>As you can see, the Limani class only defines read and write methods for the Logbook data. This means that you can implement your own Limani plugin to connect to any data source you want, as long as you implement the required methods.</p> <p>The Logbook system automatically loads and uses the Limani plugin specified in the <code>--limani</code> flag when applying the logbook, and then uses these methods to interact with the data source.</p> <p>A complete Limani plugin can be seen in here</p>"},{"location":"Plugins/provider-plugins/","title":"Provider Plugin Development","text":"<p>A \"Provider\" plugin integrates Ch-aOS with an external secret manager, enabling the secure storage and retrieval of master encryption keys. This guide details how to build a custom provider plugin.</p>"},{"location":"Plugins/provider-plugins/#core-concepts","title":"Core Concepts","text":"<p>A provider plugin is a Python package that: 1.  Implements the <code>Provider</code> abstract base class from <code>chaos.lib.secret_backends.base</code>.</p> <ol> <li>Registers itself using the <code>chaos.providers</code> entry point and the Provider required functions.</li> </ol> <p>The <code>Provider</code> class defines a standard interface for how <code>chaos</code> interacts with different secret manager CLIs. Its main purpose is to abstract the logic for:</p> <ul> <li> <p>Reading secrets (e.g., <code>bw get notes &lt;id&gt;</code>, <code>op read op://...</code>).</p> </li> <li> <p>Writing/exporting secrets (e.g., <code>bw create item</code>, <code>op item create</code>).</p> </li> <li> <p>Checking the status of the provider's CLI tool (e.g., ensuring it's installed and authenticated).</p> </li> <li> <p>That's it! The rest of the integration is handled by the base class.</p> </li> </ul>"},{"location":"Plugins/provider-plugins/#implementing-the-provider-class","title":"Implementing the <code>Provider</code> Class","text":"<p>You must create a class that inherits <code>chaos.lib.secret_backends.base</code>'s Provider class and implement its abstract methods.</p>"},{"location":"Plugins/provider-plugins/#pyprojecttoml-entry-point","title":"<code>pyproject.toml</code> Entry Point","text":"<p>First, register your class in your plugin's <code>pyproject.toml</code>:</p> <pre><code>[project.entry-points.\"chaos.providers\"]\nmy-provider = \"my_chaos_provider.main:MyProvider\"\n</code></pre>"},{"location":"Plugins/provider-plugins/#required-methods","title":"Required Methods","text":"<p>Here is a skeleton of the <code>Provider</code> class you need to implement.</p> <pre><code># src/my_chaos_provider/main.py\n\nimport argparse\nfrom typing import Tuple\nfrom chaos.lib.secret_backends.base import Provider\nfrom chaos.lib.utils import checkDep\n\nclass MyProvider(Provider):\n    @staticmethod\n    def get_cli_name() -&gt; Tuple[str, str]:\n        \"\"\"\n        Returns the flag name and the config name for the provider.\n\n        - The first element is the attribute name for the direct CLI flag (e.g., '--from-my-provider' becomes 'from_my_provider').\n        - The second element is the key used in the chaos config file.\n        \"\"\"\n        return \"from_my_provider\", \"my_provider\"\n\n    @staticmethod\n    def register_flags(parser: argparse.ArgumentParser) -&gt; None:\n        \"\"\"\n        Register a direct, ephemeral flag for your provider.\n        \"\"\"\n        parser.add_argument(\n            '--from-my-provider', '-m',\n            type=str,\n            nargs=2,\n            metavar=('ITEM_ID', 'KEY_TYPE'),\n            help='Retrieve keys from MyProvider ephemerally.'\n        )\n\n    @staticmethod\n    def register_export_subcommands(subparser: argparse._SubParsersAction) -&gt; argparse.ArgumentParser:\n        \"\"\"\n        Register subcommands for `chaos secrets export`.\n        \"\"\"\n        export_parser = subparser.add_parser('my-provider', help=\"MyProvider export options\")\n        # Add arguments specific to exporting to your provider\n        export_parser.add_argument('--some-export-option', help=\"An example export option.\")\n        return export_parser\n\n    @staticmethod\n    def register_import_subcommands(subparser: argparse._SubParsersAction) -&gt; argparse.ArgumentParser:\n        \"\"\"\n        Register subcommands for `chaos secrets import`.\n        \"\"\"\n        import_parser = subparser.add_parser('my-provider', help=\"MyProvider import options\")\n        return import_parser\n\n    def get_ephemeral_key_args(self) -&gt; tuple[str, str] | None:\n        \"\"\"\n        Return the arguments passed to the direct flag (e.g., from '--from-my-provider').\n        \"\"\"\n        return self.args.from_my_provider\n\n    def check_status(self) -&gt; Tuple[bool, str]:\n        \"\"\"\n        Check if the provider's CLI tool is installed and authenticated.\n        Raise an exception or return (False, \"error message\") if not ready.\n        \"\"\"\n        if not checkDep(\"my-provider-cli\"):\n            raise EnvironmentError(\"MyProvider CLI is not installed.\")\n\n        # Add authentication checks here\n        return True, \"MyProvider is ready.\"\n\n    def readKeys(self, item_id: str) -&gt; str:\n        \"\"\"\n        Implement the logic to read a secret from the provider's CLI or API.\n        This method should return the raw content of the secret (e.g., the notes field).\n        \"\"\"\n        # Example:\n        # result = subprocess.run(\n        #     [\"my-provider-cli\", \"get\", \"secret\", item_id],\n        #     capture_output=True, text=True, check=True\n        # )\n        # return result.stdout.strip()\n        raise NotImplementedError\n\n    def export_secrets(self) -&gt; None:\n        \"\"\"\n        Implement the logic to write a secret to the provider.\n        Access arguments via `self.args`.\n        \"\"\"\n        # key_type = self.args.key_type\n        # key_content = \"...\" # Prepare the key content\n        # subprocess.run(\n        #     [\"my-provider-cli\", \"create\", \"secret\", \"--notes\", key_content, ...],\n        #     check=True\n        # )\n        raise NotImplementedError\n</code></pre>"},{"location":"Plugins/provider-plugins/#ephemeral-environment","title":"Ephemeral Environment","text":"<p>The most complex part is <code>setupEphemeralEnv</code>, which is already partially implemented in the base class. The base implementation uses the <code>get_ephemeral_key_args</code> and <code>readKeys</code> methods you define, along with helper functions, to prepare an environment for <code>sops</code>.</p> <p>Overriding setupEphemeralEnv is bad practice, since the main Provider class already sets the ephemeral environment safely and securely for you. If your provider requires special handling, consider overriding <code>get_ephemeral_key_args</code> and <code>readKeys</code> instead, or requiring additional arguments in <code>register_flags</code>, or even requiring previously authentication in <code>check_status</code>.</p>"},{"location":"Plugins/roles/","title":"Ch-aOS Roles Plugin Documentation","text":"<p>In Ch-aOS, roles are basically just a bunch of pyinfra scripts that get executed on your servers. So why document this? Well, there are a lot of tips, tricks and best practices that can help you get the most out of roles. This documentation will cover everything you need to know about using roles in Ch-aOS.</p>"},{"location":"Plugins/roles/#first-of-all","title":"First of all","text":"<p>Ch-aOS utilizes Pyinfra's API mode to manage infrastructure. This means that roles have full access to all of Python's libraries and features, not relying solely on pyinfra's built-in functionality. This allows for more complex logic and operations within roles.</p> <p>Be sure to use only <code>host.get_fact</code> or <code>add_op</code> to run commands directly on the host. This approach lets Ch-aOS use Pyinfra's internal Topological Sorter to determine the correct order of operations, ensuring that dependencies are handled properly. It also allows Ch-aOS to properly track changes, reports, commands and everything on the Logbook.</p>"},{"location":"Plugins/roles/#how-to-declare-a-role","title":"How to declare a role","text":"<p>Just add it to your pyproject.toml like so: <pre><code>[project.entry-points.\"chaos.roles\"]\nmy-role = \"my_chaos_plugin.roles:my_role_function\"\n</code></pre> Then, in your <code>roles.py</code> file, define the role function: <pre><code>my_role_functoin(state, host, chobolo_path, skip_confirm): # If you need secrets access, add the \"secrets_dict\" param\n                                                           # It comes pre-loaded, so you can just use it (and this avoids you deleting it)\n  ...\n</code></pre></p>"},{"location":"Plugins/roles/#tips-and-tricks","title":"Tips and Tricks","text":"<p>So, best practices out of the way, lets get into some... hacky stuff.</p> <p>Want to run a command immediately on the host, without using <code>add_op</code> in order to avoid the Topo Sort or even just avoid Race conditions? Use <code>host.get_fact(Command, 'your command here')</code> to run arbitrary commands on the host. This is useful for things like checking if a service is running before trying to start it, or getting the current state of a configuration file, or even cloning a git repo before trying to manage it (Trust me, I've experienced this pain first hand when trying to do a declarative dotfiles manager).</p> <p>If you are making a trully declarative role, you can use <code>host.get_fact</code> to check the current state of the host, compare it to the desired state, and then use <code>add_op</code> with <code>server.shell</code> to make necessary changes. <code>server.shell</code> allows you to run arbitrary shell commands on the host, without needing to get the current state first, since you already have it from <code>host.get_fact</code>, you can just run the command to change the state, this is particularly useful for managing not only what to add, but also what to remove from the host. This is called \"declarative idempotency through delta calculation\".</p> <p>Want to manage files on the host? Use <code>host.get_fact(File)</code> to get the current state of a file, and then use <code>add_op</code> with <code>server.file</code> to manage the file. You can use this to ensure that a file has the correct permissions, ownership, and content. You can also use this to manage directories and symlinks.</p> <p>Other use cases are mostly covered entirely by Pyinfra, so be sure to check them out. This place is where I'll keep most of the specific workarounds and tricks that I've found useful while working with Ch-aOS roles.</p>"},{"location":"Plugins/styx/","title":"The Styx Plugin Registry","text":"<p>Styx is the official and decentralized plugin registry for Ch-aOS. It offers a simple and secure way for users to discover, install, and manage plugins that extend the functionality of <code>chaos</code>.</p> <p>Instead of a complex central server, Styx uses a Git repository containing a single YAML file (<code>registry.yaml</code>) as its source of truth. This pragmatic approach makes the system transparent, low-cost, and easy to maintain by the community.</p>"},{"location":"Plugins/styx/#using-chaos-styx","title":"Using <code>chaos styx</code>","text":"<p>The <code>chaos styx</code> command is your interface for interacting with the registry.</p>"},{"location":"Plugins/styx/#chaos-styx-list","title":"<code>chaos styx list</code>","text":"<p>Lists all plugins available in the Styx registry or information about specific plugins.</p> <p>Usage: <pre><code># List all available plugins\nchaos styx list\n\n# Get information about a specific plugin\nchaos styx list chaos-dots\n</code></pre></p> <p>This will show the plugin's name, its version, a brief description, and a link to the repository.</p>"},{"location":"Plugins/styx/#chaos-styx-invoke","title":"<code>chaos styx invoke</code>","text":"<p>Downloads and installs one or more plugins from the registry.</p> <p>Usage: <pre><code># Install the dotfiles management plugin\nchaos styx invoke chaos-dots\n</code></pre></p> <p><code>chaos</code> will query the registry, find the plugin's release URL, download the <code>.whl</code> file, and install it in the <code>~/.local/share/chaos/plugins/</code> directory.</p>"},{"location":"Plugins/styx/#chaos-styx-destroy","title":"<code>chaos styx destroy</code>","text":"<p>Removes a plugin that has been installed locally.</p> <p>Usage: <pre><code># Remove the chaos-dots plugin\nchaos styx destroy chaos-dots\n</code></pre></p> <p>This will remove the plugin's file from your local directory, effectively uninstalling it.</p>"},{"location":"Plugins/styx/#submitting-a-plugin-to-styx","title":"Submitting a Plugin to Styx","text":"<p>If you have developed a plugin and wish to share it with the community, you can submit it to Styx.</p> <p>Styx is intentionally simple and does not resolve dependencies. Therefore, plugins should be as self-contained as possible.</p> <p>To submit, open a Pull Request in the Styx repository by adding your plugin's entry to the <code>registry.yaml</code> file. The structure is as follows:</p> <pre><code>styx:\n  # Your plugin's name (as it will be called in chaos styx)\n  my-plugin:\n    # The built package name (used for the .whl file)\n    name: my_plugin\n    # The Git repository where the plugin is hosted\n    repo: https://github.com/your-username/my-plugin\n    # A brief description about your plugin\n    about: \"A plugin that does something amazing.\"\n    # The specific release version (cannot be \"latest\")\n    version: \"v0.1.0\"\n</code></pre>"},{"location":"Plugins/styx/#the-styx-security-model","title":"The Styx Security Model","text":"<p>Security is a priority in Styx. The following measures are in place to protect users:</p> <ol> <li> <p>Human Review: All new plugins and updates undergo a Pull Request review process by Ch-aOS team members before being accepted into the registry.</p> </li> <li> <p>Open Source and Transparency: All plugins listed in Styx must be open source, allowing anyone to audit the source code.</p> </li> <li> <p>Signed Commits: Contributions to the Styx registry must be made with signed commits, ensuring the authenticity of the author.</p> </li> <li> <p>Controlled Origin: Plugins are downloaded from specific, well-defined \"release\" URLs in the plugins' official repositories, reducing the risk of downloads from untrusted sources.</p> </li> <li> <p>Secure Installation: Installation occurs in a specific user directory, without the need for superuser permissions, and <code>chaos</code> performs basic checks to prevent path traversal attacks.</p> </li> </ol> <p>Although these layers create a secure environment, the good practice of only installing software from trusted sources is still encouraged.</p>"}]}