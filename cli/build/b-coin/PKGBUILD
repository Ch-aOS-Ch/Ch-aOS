# Maintainer: Dexmachi caiorocoli@gmail.com
pkgname=b-coin
pkgver=0.0.7.3b
pkgrel=1
pkgdesc="Declarative system manager for Arch Linux."
arch=('any')
_gitname="Ch-aronte"
_gituser="Ch-aOS-Ch"
_source_url="https://github.com/${_gituser}/${_gitname}"
url="git+${_source_url}.git#branch=pyinfra"

license=('MIT')
depends=('python')
makedepends=('python' 'python-pip' 'python-setuptools' 'python-wheel' 'python-pytest')

source=("${_gitname}-${pkgver}.tar.gz::${_source_url}/archive/refs/tags/v${pkgver}.tar.gz")
sha256sums=('SKIP')

check() {
  cd "$srcdir/${_gitname}-${pkgver}" 2>/dev/null || cd "$srcdir/${_gitname}-v${pkgver}"
  pytest || true
}

package() {
  cd "$srcdir/${_gitname}-${pkgver}"/cli 2>/dev/null || cd "$srcdir/${_gitname}-v${pkgver}"/cli

  python -m venv "$srcdir/pex_venv"
  local _venv_pip="$srcdir/pex_venv/bin/pip"
  local _venv_pex="$srcdir/pex_venv/bin/pex"

  "$_venv_pip" install pex

  "$_venv_pex" . -c B-coin -o B-coin --inherit-path=fallback --venv

  install -Dm755 B-coin "$pkgdir/usr/bin/B-coin"

  install -Dm644 ../LICENSE "$pkgdir/usr/share/licenses/$pkgname/LICENSE"
}
