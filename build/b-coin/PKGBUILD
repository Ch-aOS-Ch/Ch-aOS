# Maintainer: Dexmachi caiorocoli@gmail.com
pkgname=b-coin
pkgver=0.0.6.5
pkgrel=1
pkgdesc="Declarative system manager for Arch Linux."
arch=('any')
_gitname="Ch-aronte"
url="https://github.com/Ch-aOS-Ch/Ch-aronte"
license=('MIT')
depends=('python')
makedepends=('python' 'python-pip' 'python-setuptools' 'python-wheel' 'python-pytest')
source=("${_gitname}-$pkgver.tar.gz::$url/archive/refs/tags/v$pkgver.tar.gz")
sha256sums=('SKIP')

check() {
  cd "$srcdir/${_gitname}-$pkgver"
  pytest || true
}

package() {
  cd "$srcdir/${_gitname}-$pkgver"

  python -m venv "$srcdir/pex_venv"
  local _venv_pip="$srcdir/pex_venv/bin/pip"
  local _venv_pex="$srcdir/pex_venv/bin/pex"

  "$_venv_pip" install pex

  "$_venv_pex" . -c B-coin -o B-coin --inherit-path=fallback

  install -Dm755 B-coin "$pkgdir/usr/bin/B-coin"

  install -Dm644 LICENSE "$pkgdir/usr/share/licenses/$pkgname/LICENSE"}
}
